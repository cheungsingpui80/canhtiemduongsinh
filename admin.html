<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Quản Trị - Canh Tiềm Dưỡng Sinh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .tab-content, .modal, #toast-notification {
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .lang-btn.active {
            background-color: #4f46e5;
            color: white;
        }
        .stat-card:hover {
             border-color: var(--status-color, #d1d5db); /* Default to gray-300 */
             transform: translateY(-2px);
             transition: all 0.2s ease-in-out;
        }
        .sidebar-link.active {
            background-color: #4a5568; /* a shade of gray */
        }
        #toast-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            transition: opacity 0.3s, transform 0.3s;
        }
        #toast-notification.success { background-color: #10B981; color: white; }
        #toast-notification.error { background-color: #EF4444; color: white; }
    </style>
</head>
<body class="bg-gray-100">

    <div id="toast-notification" class="hidden"></div>

    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="w-64 bg-gray-800 text-white flex flex-col">
            <div class="px-8 py-6">
                <h2 class="text-2xl font-semibold" data-lang="dashboard_title">Bảng Điều Khiển</h2>
            </div>
             <!-- Language Switcher -->
            <div class="px-4 py-2">
                <div class="flex bg-gray-700 rounded-lg p-1">
                    <button class="lang-btn flex-1 text-sm py-1 px-2 rounded-md" data-lang-code="vi">Tiếng Việt</button>
                    <button class="lang-btn flex-1 text-sm py-1 px-2 rounded-md" data-lang-code="zh">繁體中文</button>
                </div>
            </div>
            <nav class="flex-1 px-4 py-2 space-y-2 overflow-y-auto">
                <a href="#" class="tab-link active:bg-gray-700 bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="dashboard">
                    <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" /></svg>
                    <span data-lang="dashboard_overview">Tổng Quan</span>
                </a>
                 <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="employee-management">
                    <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-4.663M12 12A3 3 0 1012 6a3 3 0 000 6z" /></svg>
                    <span data-lang="employee_management">Quản Lý Nhân Viên</span>
                </a>
                 <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="payroll-management">
                    <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V6.375c0-.621.504-1.125 1.125-1.125h.375m18 0h-4.5M3.75 18.75h4.5m10.5 0h-4.5c-.414 0-.75-.336-.75-.75V15c0-.414.336-.75.75-.75h4.5c.414 0 .75.336.75.75v3c0 .414-.336.75-.75.75z" />
                    </svg>
                    <span data-lang="payroll_management">Quản Lý Lương</span>
                </a>
                <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="sales-management">
                    <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c.51 0 .962-.343 1.087-.835l.383-1.437M7.5 14.25L5.106 5.165A2.25 2.25 0 002.854 3H2.25" />
                    </svg>
                    <span data-lang="order_lookup">Tra Cứu Đơn Hàng</span>
                </a>
                <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="menu-management">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                    <span data-lang="menu_management">Quản Lý Thực Đơn</span>
                </a>
                <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="supplier-management">
                     <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975m11.963 0a9 9 0 10-11.963 0m11.963 0A8.966 8.966 0 0112 21a8.966 8.966 0 01-5.982-2.275M15 9.75a3 3 0 11-6 0 3 3 0 016 0z" />
                     </svg>
                     <span data-lang="supplier_management">Nhà Cung Cấp</span>
                </a>
                <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="purchase-management">
                     <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" /></svg>
                     <span data-lang="material_management">Nguyên Vật Liệu</span>
                </a>
                <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="spoilage-management">
                    <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg>
                    <span data-lang="spoilage_management">Quản Lý Hư Hao</span>
                </a>
                <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="cost-management">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 8h6m-5 4h4m5 6H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2z"></path></svg>
                    <span data-lang="other_costs">Chi Phí Khác</span>
                </a>
                <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="profit-report">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path></svg>
                    <span data-lang="profit_report">Báo Cáo Lợi Nhuận</span>
                </a>
                <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="inventory-report">
                    <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-1.621-1.621A3 3 0 0115 18.257V17.25m6-12V15a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 15V5.25A2.25 2.25 0 015.25 3h4.5M15 3.75a2.25 2.25 0 012.25 2.25V6a2.25 2.25 0 01-2.25 2.25H8.25A2.25 2.25 0 016 6V5.25a2.25 2.25 0 012.25-2.25h4.5M15 3.75h-4.5m0 0a2.25 2.25 0 012.25 2.25V6" />
                    </svg>
                    <span data-lang="inventory_report">Báo Cáo Tồn Kho</span>
                </a>
                <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="adjustment-logs">
                     <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
                    </svg>
                    <span data-lang="adjustment_logs">Lịch Sử Điều Chỉnh</span>
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <main class="flex-1 p-6 md:p-10 overflow-y-auto">
            
            <!-- Tab: Dashboard -->
            <div id="dashboard" class="tab-content active">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="dashboard_overview">Tổng Quan Hôm Nay</h1>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Dashboard cards will be injected here -->
                    <div class="bg-white p-6 rounded-lg shadow-md flex items-center">
                        <div class="bg-blue-100 p-3 rounded-full mr-4"><svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01"></path></svg></div>
                        <div>
                            <p class="text-sm text-gray-500" data-lang="today_revenue">Doanh thu hôm nay</p>
                            <p id="dashboard-revenue" class="text-2xl font-bold">0 VND</p>
                        </div>
                    </div>
                     <div class="bg-white p-6 rounded-lg shadow-md flex items-center">
                        <div class="bg-green-100 p-3 rounded-full mr-4"><svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg></div>
                        <div>
                            <p class="text-sm text-gray-500" data-lang="today_orders">Đơn hàng mới</p>
                            <p id="dashboard-orders" class="text-2xl font-bold">0</p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md flex items-center">
                        <div class="bg-yellow-100 p-3 rounded-full mr-4"><svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path></svg></div>
                        <div>
                            <p class="text-sm text-gray-500" data-lang="best_selling_dish">Món bán chạy nhất</p>
                            <p id="dashboard-best-seller" class="text-lg font-bold">N/A</p>
                        </div>
                    </div>
                     <div class="bg-white p-6 rounded-lg shadow-md flex items-center">
                        <div class="bg-red-100 p-3 rounded-full mr-4"><svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg></div>
                        <div>
                            <p class="text-sm text-gray-500" data-lang="low_stock_alert">Cảnh báo tồn kho</p>
                            <p id="dashboard-low-stock" class="text-2xl font-bold">0</p>
                        </div>
                    </div>
                </div>
                <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold mb-4" data-lang="order_status_distribution">Phân bổ Trạng thái Đơn hàng</h3>
                        <canvas id="orderStatusChart"></canvas>
                    </div>
                     <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold mb-4" data-lang="recent_activity">Hoạt động Gần đây</h3>
                        <div id="dashboard-recent-activity" class="space-y-3 max-h-60 overflow-y-auto"></div>
                    </div>
                </div>
            </div>

             <!-- Tab: Quản Lý Nhân Viên -->
            <div id="employee-management" class="tab-content">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="employee_management_title">Quản Lý Nhân Viên</h1>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h2 class="text-xl font-semibold mb-4" data-lang="add_new_employee">Thêm Nhân Viên Mới</h2>
                            <form id="add-employee-form" class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="employee-name" class="block text-sm font-medium text-gray-700" data-lang="employee_name">Họ và Tên</label>
                                        <input type="text" id="employee-name" required class="mt-1 block w-full border-gray-300 rounded-md py-2 px-3">
                                    </div>
                                    <div>
                                        <label for="employee-id-code" class="block text-sm font-medium text-gray-700" data-lang="employee_id_code">Mã số nhân viên</label>
                                        <input type="text" id="employee-id-code" required class="mt-1 block w-full border-gray-300 rounded-md py-2 px-3">
                                    </div>
                                    <div>
                                        <label for="employee-dob" class="block text-sm font-medium text-gray-700" data-lang="employee_dob">Ngày sinh</label>
                                        <input type="date" id="employee-dob" required class="mt-1 block w-full border-gray-300 rounded-md py-2 px-3" min="1900-01-01" max="2999-12-31">
                                    </div>
                                    <div>
                                        <label for="employee-nid" class="block text-sm font-medium text-gray-700" data-lang="employee_nid">Số CCCD/CC</label>
                                        <input type="text" id="employee-nid" required class="mt-1 block w-full border-gray-300 rounded-md py-2 px-3">
                                    </div>
                                </div>
                                <div>
                                    <label for="employee-photo-url" class="block text-sm font-medium text-gray-700" data-lang="employee_photo_url">URL Hình ảnh</label>
                                    <input type="url" id="employee-photo-url" data-lang-placeholder="employee_photo_url_placeholder" placeholder="https://example.com/photo.jpg" class="mt-1 block w-full border-gray-300 rounded-md py-2 px-3">
                                </div>
                                 <div>
                                    <label for="employee-permanent-address" class="block text-sm font-medium text-gray-700" data-lang="employee_permanent_address">Địa chỉ thường trú</label>
                                    <input type="text" id="employee-permanent-address" required class="mt-1 block w-full border-gray-300 rounded-md py-2 px-3">
                                </div>
                                <div>
                                    <label for="employee-current-address" class="block text-sm font-medium text-gray-700" data-lang="employee_current_address">Địa chỉ hiện tại</label>
                                    <input type="text" id="employee-current-address" required class="mt-1 block w-full border-gray-300 rounded-md py-2 px-3">
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                     <div>
                                        <label for="employee-start-date" class="block text-sm font-medium text-gray-700" data-lang="employee_start_date">Ngày nhận việc</label>
                                        <input type="date" id="employee-start-date" required class="mt-1 block w-full border-gray-300 rounded-md py-2 px-3" min="1900-01-01" max="2999-12-31">
                                    </div>
                                    <div>
                                        <label for="employee-type" class="block text-sm font-medium text-gray-700" data-lang="employee_type">Hình thức làm việc</label>
                                        <select id="employee-type" required class="mt-1 block w-full border-gray-300 rounded-md py-2 px-3">
                                            <option value="part-time" data-lang="employee_type_part_time">Bán thời gian</option>
                                            <option value="contract" data-lang="employee_type_contract">Hợp đồng lao động</option>
                                        </select>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700" data-lang="roles">Vai trò</label>
                                    <div id="employee-roles-checkboxes" class="mt-2 space-y-2">
                                        <!-- Checkboxes will be inserted here by JS -->
                                    </div>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700" data-lang="add_employee_btn">Thêm Nhân Viên</button>
                            </form>
                        </div>
                    </div>
                    <div class="lg:col-span-2">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h2 class="text-xl font-semibold mb-4" data-lang="employee_list">Danh Sách Nhân Viên</h2>
                            <div id="employees-list" class="space-y-4 max-h-[80vh] overflow-y-auto"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Payroll Management -->
            <div id="payroll-management" class="tab-content">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="payroll_management_title">Chấm Công & Tính Lương</h1>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="flex items-center gap-4 mb-6 pb-6 border-b">
                        <div>
                            <label for="payroll-month" class="block text-sm font-medium text-gray-700" data-lang="timesheet_for_month">Bảng Chấm Công Tháng</label>
                            <input type="month" id="payroll-month" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div class="self-end">
                            <button id="load-timesheet-btn" class="bg-blue-600 text-white py-2 px-5 rounded-md hover:bg-blue-700" data-lang="load_timesheet_data">Tải Dữ Liệu</button>
                        </div>
                    </div>

                    <div id="timesheet-container" class="hidden">
                        <h2 class="text-xl font-semibold mb-4">Bảng chấm công và thưởng phạt</h2>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" data-lang="employee">Nhân viên</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" data-lang="salary_rate">Mức lương</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" data-lang="salary_for_insurance">Lương đóng BH</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" data-lang="hours_worked">Giờ làm việc</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" data-lang="performance_bonus">Thưởng/Phạt (VND)</th>
                                    </tr>
                                </thead>
                                <tbody id="timesheet-table-body" class="bg-white divide-y divide-gray-200">
                                    <!-- Timesheet rows will be injected here -->
                                </tbody>
                            </table>
                        </div>
                        <div class="text-right mt-6">
                            <button id="calculate-payroll-btn" class="bg-green-600 text-white py-2 px-5 rounded-md hover:bg-green-700" data-lang="calculate_payroll">Tính Lương</button>
                        </div>
                    </div>

                    <div id="payroll-results-container" class="hidden mt-8 pt-6 border-t">
                        <h2 id="payroll-results-title" class="text-xl font-semibold mb-4">Bảng lương</h2>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase" data-lang="employee">Nhân viên</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase" data-lang="gross_salary">Lương Gộp</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase" data-lang="social_insurance">BHXH (8%)</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase" data-lang="health_insurance">BHYT (1.5%)</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase" data-lang="unemployment_insurance">BHTN (1%)</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase" data-lang="total_deductions">Tổng khấu trừ</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase" data-lang="performance_bonus">Thưởng/Phạt</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase" data-lang="net_salary">Thực Lĩnh</th>
                                    </tr>
                                </thead>
                                <tbody id="payroll-results-table-body" class="bg-white divide-y divide-gray-200">
                                    <!-- Payroll results will be injected here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Tra Cứu Đơn Hàng -->
            <div id="sales-management" class="tab-content">
                 <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="order_lookup_title">Tra Cứu Đơn Hàng</h1>
                 <div class="bg-white p-6 rounded-lg shadow-md">
                    <!-- Filters -->
                    <div class="flex flex-wrap items-center gap-4 mb-6 pb-6 border-b">
                        <div>
                            <label for="order-lookup-preset-filter" class="block text-sm font-medium text-gray-700" data-lang="view_by">Xem theo</label>
                            <select id="order-lookup-preset-filter" class="mt-1 block w-full md:w-auto border-gray-300 rounded-md shadow-sm">
                                <option value="this_month" data-lang="this_month">Tháng này</option>
                                <option value="this_quarter" data-lang="this_quarter">Quí này</option>
                                <option value="this_year" data-lang="this_year">Năm này</option>
                                <option value="custom" data-lang="custom_option">Tùy chọn</option>
                            </select>
                        </div>
                        <div>
                            <label for="order-lookup-start-date" class="block text-sm font-medium text-gray-700" data-lang="from_date">Từ ngày</label>
                            <input type="date" id="order-lookup-start-date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" min="1900-01-01" max="2999-12-31">
                        </div>
                        <div>
                            <label for="order-lookup-end-date" class="block text-sm font-medium text-gray-700" data-lang="to_date">Đến ngày</label>
                            <input type="date" id="order-lookup-end-date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" min="1900-01-01" max="2999-12-31">
                        </div>
                        <div class="self-end">
                            <button id="order-lookup-btn" class="bg-blue-600 text-white py-2 px-5 rounded-md hover:bg-blue-700" data-lang="search_btn">Tra cứu</button>
                        </div>
                    </div>
                    
                    <!-- Statistics Section -->
                    <div id="order-stats" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                        <!-- Stat cards will be injected here by JS -->
                    </div>

                    <!-- Order Details Section -->
                    <div id="order-details-container" class="mt-8">
                         <h3 id="order-details-title" class="text-xl font-semibold mb-4 hidden"></h3>
                         <div id="order-details-list" class="space-y-3 max-h-[50vh] overflow-y-auto"></div>
                    </div>
                </div>
            </div>

            <!-- Tab: Quản Lý Thực Đơn -->
            <div id="menu-management" class="tab-content">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="menu_management_title">Quản Lý Thực Đơn &amp; Định Lượng (BOM)</h1>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Form thêm món ăn -->
                    <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold mb-4" data-lang="add_new_dish">Thêm Món Mới</h2>
                        <form id="add-dish-form" class="space-y-4">
                            <!-- Basic Info -->
                            <div>
                                <label for="dish-name" class="block text-sm font-medium text-gray-700" data-lang="dish_name">Tên món</label>
                                <input type="text" id="dish-name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">
                            </div>
                            <div>
                                <label for="dish-description" class="block text-sm font-medium text-gray-700" data-lang="description">Mô tả</label>
                                <textarea id="dish-description" rows="4" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></textarea>
                            </div>
                            <div>
                                <label for="dish-price" class="block text-sm font-medium text-gray-700" data-lang="selling_price">Giá Bán (VND)</label>
                                <input type="number" id="dish-price" min="0" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">
                            </div>
                             <div>
                                <label for="dish-image-url" class="block text-sm font-medium text-gray-700" data-lang="image_url">URL Hình ảnh</label>
                                <input type="text" id="dish-image-url" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">
                            </div>
                            <!-- BOM Section -->
                            <div class="pt-4 border-t">
                                <h3 class="text-lg font-medium text-gray-800 mb-2" data-lang="bom_title">Định Lượng Nguyên Liệu (BOM)</h3>
                                <div class="flex gap-2 items-center">
                                    <select id="bom-material-select" class="flex-grow border border-gray-300 rounded-md shadow-sm py-2 px-3"></select>
                                    <input type="number" id="bom-quantity" data-lang-placeholder="quantity_short" placeholder="SL" class="w-20 border border-gray-300 rounded-md shadow-sm py-2 px-3">
                                    <button type="button" id="add-bom-item-btn" class="bg-gray-600 text-white px-3 py-2 rounded-md hover:bg-gray-700">+</button>
                                </div>
                                <div id="bom-items-list" class="mt-2 space-y-1"></div>
                                <div class="mt-2 font-semibold text-right"><span data-lang="estimated_cost">Giá vốn ước tính</span>: <span id="estimated-cost">0 VND</span></div>
                            </div>
                            <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700" data-lang="add_dish_btn">Thêm Món</button>
                        </form>
                    </div>
                    <!-- Danh sách món ăn -->
                    <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold mb-4" data-lang="current_dishes_list">Danh Sách Món Ăn Hiện Có</h2>
                        <div id="dishes-list" class="space-y-4"></div>
                    </div>
                </div>
            </div>

            <!-- Tab: Quản Lý Nhà Cung Cấp -->
            <div id="supplier-management" class="tab-content">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="supplier_management_title">Quản Lý Nhà Cung Cấp</h1>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-1">
                             <h3 class="text-lg font-medium mb-2" data-lang="add_new_supplier">Thêm NCC Mới</h3>
                             <form id="add-supplier-form" class="space-y-4">
                                <input type="text" id="supplier-name" data-lang-placeholder="supplier_name" placeholder="Tên nhà cung cấp" required class="block w-full border-gray-300 rounded-md py-2 px-3">
                                <input type="text" id="supplier-contact" data-lang-placeholder="contact_person" placeholder="Người liên hệ" class="block w-full border-gray-300 rounded-md py-2 px-3">
                                <input type="tel" id="supplier-phone" data-lang-placeholder="phone_number" placeholder="Số điện thoại" class="block w-full border-gray-300 rounded-md py-2 px-3">
                                <input type="text" id="supplier-address" data-lang-placeholder="address" placeholder="Địa chỉ" class="block w-full border-gray-300 rounded-md py-2 px-3">
                                <input type="text" id="supplier-taxcode" data-lang-placeholder="tax_code" placeholder="Mã số thuế (nếu có)" class="block w-full border-gray-300 rounded-md py-2 px-3">
                                <button type="submit" class="w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700" data-lang="add_supplier_btn">Thêm NCC</button>
                            </form>
                        </div>
                        <div class="lg:col-span-2">
                             <h3 class="text-lg font-medium mb-2" data-lang="suppliers_list_title">Danh Sách Nhà Cung Cấp</h3>
                             <div id="suppliers-list" class="mt-4 space-y-3 max-h-96 overflow-y-auto"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Nguyên Vật Liệu Mua Vào -->
            <div id="purchase-management" class="tab-content">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="purchase_management_title">Nguyên Vật Liệu & Nhập Kho</h1>
                 <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Column 1: Category Management -->
                    <div class="space-y-6 bg-white p-6 rounded-lg shadow-md">
                        <div>
                            <h3 class="text-lg font-medium mb-2" data-lang="material_categories">Phân loại Nguyên vật liệu</h3>
                            <form id="add-category-form" class="flex gap-2 mb-4">
                                <input type="text" id="category-name" data-lang-placeholder="category_name_placeholder" placeholder="Tên phân loại mới" required class="flex-grow border border-gray-300 rounded-md py-2 px-3">
                                <button type="submit" class="bg-indigo-600 text-white px-4 rounded-md hover:bg-indigo-700" data-lang="add_btn">Thêm</button>
                            </form>
                            <div id="material-categories-list" class="space-y-2 max-h-[200px] overflow-y-auto"></div>
                        </div>
                        <div class="border-t pt-4">
                            <h3 class="text-lg font-medium mb-2" data-lang="define_material">Định Nghĩa Nguyên Vật Liệu</h3>
                            <form id="add-material-form" class="space-y-4">
                                <input type="text" id="material-name" data-lang-placeholder="material_name" placeholder="Tên nguyên liệu" required class="w-full border border-gray-300 rounded-md py-2 px-3">
                                <input type="text" id="material-unit" data-lang-placeholder="unit_placeholder" placeholder="Đơn vị (kg, gr, cái)" required class="w-full border border-gray-300 rounded-md py-2 px-3">
                                 <input type="number" id="material-min-stock" data-lang-placeholder="min_stock_placeholder" placeholder="Tồn kho tối thiểu" required class="w-full border border-gray-300 rounded-md py-2 px-3">
                                <select id="material-category-select" class="w-full border border-gray-300 rounded-md py-2 px-3"></select>
                                <button type="submit" class="w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700" data-lang="add_btn">Thêm Nguyên Liệu</button>
                            </form>
                        </div>
                    </div>

                    <!-- Column 2: Materials List & Purchase History -->
                     <div class="space-y-6 bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-medium mb-2" data-lang="materials_list_title">Danh Sách Nguyên Vật Liệu</h3>
                        <input type="text" id="search-material-input" data-lang-placeholder="search_material_placeholder" placeholder="Tìm kiếm nguyên vật liệu..." class="w-full border border-gray-300 rounded-md py-2 px-3 mb-4">
                        <div id="materials-list" class="space-y-4 max-h-[65vh] overflow-y-auto"></div>
                    </div>

                    <!-- Column 3: Record Purchases -->
                    <div class="space-y-6 bg-white p-6 rounded-lg shadow-md">
                        <div>
                            <h3 class="text-lg font-medium mb-2" data-lang="record_purchase">Nhập Kho</h3>
                            <form id="add-purchase-form" class="space-y-4 p-4 border rounded-md">
                                <div>
                                    <label class="block text-sm font-medium" data-lang="purchase_date">Ngày nhập hàng</label>
                                    <input type="date" id="purchase-date" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3" min="1900-01-01" max="2999-12-31">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium" data-lang="material">Nguyên liệu</label>
                                    <select id="purchase-material-select" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3"></select>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium" data-lang="quantity">Số lượng</label>
                                        <input type="number" id="purchase-quantity" min="0" step="any" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium" data-lang="unit">Đơn vị</label>
                                        <input type="text" id="purchase-unit" readonly class="mt-1 block w-full bg-gray-100 border border-gray-300 rounded-md py-2 px-3">
                                    </div>
                                </div>
                                 <div>
                                    <label class="block text-sm font-medium" data-lang="total_price">Tổng tiền (VND)</label>
                                    <input type="number" id="purchase-total-price" min="0" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3">
                                </div>
                                 <div>
                                    <label class="block text-sm font-medium" data-lang="supplier">Nhà cung cấp</label>
                                    <select id="purchase-supplier-select" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3"></select>
                                </div>
                                <p class="text-right"><span data-lang="new_unit_price_label">Đơn giá mới sẽ là</span>: <span id="new-unit-price" class="font-semibold">0 VND</span></p>
                                <button type="submit" class="w-full bg-green-600 text-white py-2 rounded-md hover:bg-green-700" data-lang="confirm_purchase_btn">Xác Nhận Nhập Kho</button>
                            </form>
                        </div>
                         <div class="border-t pt-4">
                             <h3 class="text-lg font-semibold mb-2" data-lang="purchase_history_title">Lịch Sử Nhập Kho</h3>
                             <div id="purchases-list" class="space-y-2 max-h-60 overflow-y-auto"></div>
                         </div>
                    </div>
                </div>
            </div>

             <!-- Tab: Quản Lý Hư Hao -->
            <div id="spoilage-management" class="tab-content">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="spoilage_management_title">Quản Lý Nguyên Vật Liệu Hư Hao</h1>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Form for adding spoilage -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold mb-4" data-lang="record_spoilage">Ghi Nhận Hư Hao</h2>
                        <form id="add-spoilage-form" class="space-y-4">
                            <div>
                                <label for="spoilage-date" class="block text-sm font-medium text-gray-700" data-lang="spoilage_date">Ngày thải bỏ</label>
                                <input type="date" id="spoilage-date" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3" min="1900-01-01" max="2999-12-31">
                            </div>
                            <div>
                                <label for="spoilage-material-select" class="block text-sm font-medium text-gray-700" data-lang="material">Nguyên liệu</label>
                                <select id="spoilage-material-select" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3"></select>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="spoilage-quantity" class="block text-sm font-medium text-gray-700" data-lang="quantity">Số lượng</label>
                                    <input type="number" id="spoilage-quantity" min="0" step="any" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700" data-lang="unit">Đơn vị tính</label>
                                    <input type="text" id="spoilage-unit" readonly class="mt-1 block w-full bg-gray-100 border border-gray-300 rounded-md py-2 px-3">
                                </div>
                            </div>
                             <div>
                                <label for="spoilage-reason" class="block text-sm font-medium text-gray-700" data-lang="spoilage_reason">Nguyên nhân thải bỏ</label>
                                <input type="text" id="spoilage-reason" required data-lang-placeholder="spoilage_reason_placeholder" placeholder="VD: Hết hạn, hỏng..." class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3">
                            </div>
                            <button type="submit" class="w-full bg-red-600 text-white py-2 rounded-md hover:bg-red-700" data-lang="record_btn">Ghi Nhận</button>
                        </form>
                    </div>
                    <!-- List of spoilage records -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold mb-4" data-lang="spoilage_history_title">Lịch Sử Hư Hao</h2>
                        <div id="spoilage-list" class="space-y-2 max-h-80 overflow-y-auto"></div>
                    </div>
                </div>
            </div>

            <!-- Tab: Chi Phí Khác -->
            <div id="cost-management" class="tab-content">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="other_costs_title">Quản Lý Chi Phí Khác</h1>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Add Cost Form -->
                    <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold mb-4" data-lang="add_new_cost">Thêm Chi Phí Mới</h2>
                        <form id="add-other-cost-form" class="space-y-4">
                            <div>
                                <label for="other-cost-name" class="block text-sm font-medium text-gray-700" data-lang="cost_name">Tên chi phí</label>
                                <input type="text" id="other-cost-name" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3">
                            </div>
                            <div>
                                <label for="other-cost-amount" class="block text-sm font-medium text-gray-700" data-lang="amount">Số tiền (VND)</label>
                                <input type="number" id="other-cost-amount" min="0" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3">
                            </div>
                            <div>
                                <label for="other-cost-frequency" class="block text-sm font-medium text-gray-700" data-lang="cost_type">Loại chi phí</label>
                                <select id="other-cost-frequency" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3">
                                    <option value="monthly" data-lang="monthly">Hàng tháng</option>
                                    <option value="yearly" data-lang="yearly">Hàng năm</option>
                                    <option value="onetime" data-lang="onetime">Một lần (Đầu tư)</option>
                                </select>
                            </div>
                            <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700" data-lang="add_cost_btn">Thêm Chi Phí</button>
                        </form>
                    </div>
                    <!-- Display Costs -->
                    <div class="lg:col-span-2 space-y-6">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold mb-3" data-lang="monthly_costs">Chi phí hàng tháng</h3>
                            <div id="monthly-costs-list" class="space-y-2"></div>
                            <div class="mt-4 pt-4 border-t font-bold flex justify-between">
                                <span data-lang="total_monthly">Tổng cộng tháng:</span><span id="total-monthly-costs">0 VND</span>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold mb-3" data-lang="yearly_costs">Chi phí hàng năm</h3>
                            <div id="yearly-costs-list" class="space-y-2"></div>
                             <div class="mt-4 pt-4 border-t font-bold flex justify-between">
                                <span data-lang="total_yearly">Tổng cộng năm:</span><span id="total-yearly-costs">0 VND</span>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold mb-3" data-lang="onetime_costs">Chi phí một lần (Đầu tư)</h3>
                            <div id="onetime-costs-list" class="space-y-2"></div>
                             <div class="mt-4 pt-4 border-t font-bold flex justify-between">
                                <span data-lang="total">Tổng cộng:</span><span id="total-onetime-costs">0 VND</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Báo Cáo Lợi Nhuận -->
            <div id="profit-report" class="tab-content">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="profit_report_title">Báo Cáo Lợi Nhuận</h1>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="flex flex-wrap items-center gap-4 mb-6 pb-6 border-b">
                         <div>
                            <label for="profit-report-preset-filter" class="block text-sm font-medium text-gray-700" data-lang="view_by">Xem theo</label>
                            <select id="profit-report-preset-filter" class="mt-1 block w-full md:w-auto border-gray-300 rounded-md shadow-sm">
                                <option value="this_month" data-lang="this_month">Tháng này</option>
                                <option value="this_quarter" data-lang="this_quarter">Quí này</option>
                                <option value="this_year" data-lang="this_year">Năm này</option>
                                <option value="custom" data-lang="custom_option">Tùy chọn</option>
                            </select>
                        </div>
                        <div>
                            <label for="profit-report-start-date" class="block text-sm font-medium text-gray-700" data-lang="from_date">Từ ngày</label>
                            <input type="date" id="profit-report-start-date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" min="1900-01-01" max="2999-12-31">
                        </div>
                        <div>
                            <label for="profit-report-end-date" class="block text-sm font-medium text-gray-700" data-lang="to_date">Đến ngày</label>
                            <input type="date" id="profit-report-end-date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" min="1900-01-01" max="2999-12-31">
                        </div>
                        <div class="self-end">
                            <button id="calculate-profit-btn" class="w-full bg-green-600 text-white py-2 px-5 rounded-md hover:bg-green-700" data-lang="calculate_profit_btn">Xem Báo Cáo</button>
                        </div>
                    </div>
                    <div id="profit-results" class="mt-8 pt-6 border-t hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="lg:col-span-2">
                                <h3 class="text-2xl font-semibold mb-4 text-center" data-lang="business_results_period">Kết Quả Kinh Doanh Trong Kỳ</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-lg">
                                    <div class="bg-blue-50 p-4 rounded-md"><p class="text-gray-600" data-lang="total_revenue">Tổng Doanh Thu:</p><p id="result-revenue" class="font-bold text-2xl text-blue-700">0 VND</p></div>
                                    <div class="bg-orange-50 p-4 rounded-md"><p class="text-gray-600" data-lang="total_cogs">Tổng Giá Vốn Hàng Bán:</p><p id="result-cogs" class="font-bold text-2xl text-orange-700">0 VND</p></div>
                                     <div class="bg-red-50 p-4 rounded-md"><p class="text-gray-600" data-lang="total_commission_fees">Tổng Phí Chiết Khấu:</p><p id="result-commission-fees" class="font-bold text-2xl text-red-700">0 VND</p></div>
                                    <div class="bg-yellow-50 p-4 rounded-md"><p class="text-gray-600" data-lang="total_operating_expenses">Tổng Chi Phí Hoạt Động (Tháng):</p><p id="result-monthly-expense" class="font-bold text-2xl text-yellow-700">0 VND</p></div>
                                    <div class="bg-red-100 p-4 rounded-md"><p class="text-gray-600" data-lang="spoilage_cost">Chi Phí Hư Hao (Ước Tính):</p><p id="result-spoilage-cost" class="font-bold text-2xl text-red-800">0 VND</p></div>
                                    <div class="bg-green-100 p-4 rounded-md"><p class="text-gray-600" data-lang="net_profit">Lợi Nhuận Ròng (Trước Thuế):</p><p id="result-net-profit" class="font-bold text-3xl text-green-800">0 VND</p></div>
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg">
                                <h3 class="text-lg font-semibold mb-4" data-lang="revenue_structure">Cơ cấu doanh thu</h3>
                                <canvas id="revenueStructureChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tab: Báo Cáo Tồn Kho -->
            <div id="inventory-report" class="tab-content">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="inventory_report_title">Báo Cáo Xuất Nhập Tồn Nguyên Liệu</h1>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="flex flex-wrap items-center gap-4 mb-6 pb-6 border-b">
                        <div>
                            <label for="report-preset-filter" class="block text-sm font-medium text-gray-700" data-lang="view_by">Xem theo</label>
                            <select id="report-preset-filter" class="mt-1 block w-full md:w-auto border-gray-300 rounded-md shadow-sm">
                                <option value="this_month" data-lang="this_month">Tháng này</option>
                                <option value="this_quarter" data-lang="this_quarter">Quí này</option>
                                <option value="this_year" data-lang="this_year">Năm này</option>
                                <option value="custom" data-lang="custom_option">Tùy chọn</option>
                            </select>
                        </div>
                        <div>
                            <label for="report-start-date" class="block text-sm font-medium text-gray-700" data-lang="from_date">Từ ngày</label>
                            <input type="date" id="report-start-date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" min="1900-01-01" max="2999-12-31">
                        </div>
                        <div>
                            <label for="report-end-date" class="block text-sm font-medium text-gray-700" data-lang="to_date">Đến ngày</label>
                            <input type="date" id="report-end-date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" min="1900-01-01" max="2999-12-31">
                        </div>
                        <div class="self-end">
                            <button id="view-inventory-report-btn" class="bg-blue-600 text-white py-2 px-5 rounded-md hover:bg-blue-700" data-lang="view_report_btn">Xem Báo Cáo</button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-lang="material_name_header">Tên Nguyên Liệu</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-lang="unit_header">ĐVT</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-lang="opening_stock">Tồn Đầu Kỳ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-lang="purchased_in_period">Nhập Trong Kỳ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-lang="used_in_period">Xuất Trong Kỳ (Bán)</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-lang="spoiled_in_period">Hư Hao Trong Kỳ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-lang="closing_stock">Tồn Cuối Kỳ</th>
                                </tr>
                            </thead>
                            <tbody id="inventory-report-body" class="bg-white divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Tab: Lịch sử điều chỉnh -->
            <div id="adjustment-logs" class="tab-content">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="adjustment_logs_title">Lịch Sử Điều Chỉnh Dữ Liệu</h1>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div id="adjustment-logs-list" class="space-y-4"></div>
                </div>
            </div>

        </main>
    </div>

    <!-- Modals -->
    <div id="employee-details-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center overflow-y-auto p-4">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl max-h-[90vh] flex flex-col">
            <h2 class="text-2xl font-bold mb-4" data-lang="employee_details_title">Thông Tin Chi Tiết Nhân Viên</h2>
            <div id="employee-modal-content" class="overflow-y-auto pr-2">
                <!-- Details will be injected here -->
            </div>
             <div class="flex justify-end gap-4 mt-6 pt-4 border-t">
                <button type="button" id="close-employee-modal-btn" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-md" data-lang="cancel_btn">Đóng</button>
            </div>
        </div>
    </div>
     <div id="edit-supplier-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg">
            <h2 class="text-2xl font-bold mb-4" data-lang="edit_supplier_title">Điều Chỉnh Thông Tin Nhà Cung Cấp</h2>
            <form id="edit-supplier-form" class="space-y-4">
                <input type="hidden" id="edit-supplier-id">
                <input type="text" id="edit-supplier-name" data-lang-placeholder="supplier_name" required class="block w-full border-gray-300 rounded-md py-2 px-3">
                <input type="text" id="edit-supplier-contact" data-lang-placeholder="contact_person" class="block w-full border-gray-300 rounded-md py-2 px-3">
                <input type="tel" id="edit-supplier-phone" data-lang-placeholder="phone_number" class="block w-full border-gray-300 rounded-md py-2 px-3">
                <input type="text" id="edit-supplier-address" data-lang-placeholder="address" class="block w-full border-gray-300 rounded-md py-2 px-3">
                <input type="text" id="edit-supplier-taxcode" data-lang-placeholder="tax_code" class="block w-full border-gray-300 rounded-md py-2 px-3">
                <div class="flex justify-end gap-4 mt-6">
                    <button type="button" id="cancel-edit-supplier-btn" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-md" data-lang="cancel_btn">Hủy</button>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md" data-lang="save_changes_btn">Lưu Thay Đổi</button>
                </div>
            </form>
        </div>
    </div>
    <div id="edit-purchase-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center">
        <!-- ... (Modal content unchanged) ... -->
    </div>

    <!-- Edit Dish Modal -->
    <div id="edit-dish-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg max-h-[90vh] flex flex-col">
            <h2 class="text-2xl font-bold mb-4" data-lang="edit_dish_title">Điều Chỉnh Thông Tin Món Ăn</h2>
            <form id="edit-dish-form" class="space-y-4 overflow-y-auto pr-2">
                <input type="hidden" id="edit-dish-id">
                <!-- Basic Info -->
                <div>
                    <label for="edit-dish-name" class="block text-sm font-medium text-gray-700" data-lang="dish_name">Tên món</label>
                    <input type="text" id="edit-dish-name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">
                </div>
                <div>
                    <label for="edit-dish-description" class="block text-sm font-medium text-gray-700" data-lang="description">Mô tả</label>
                    <textarea id="edit-dish-description" rows="3" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></textarea>
                </div>
                <div>
                    <label for="edit-dish-image-url" class="block text-sm font-medium text-gray-700" data-lang="image_url">URL Hình ảnh</label>
                    <input type="text" id="edit-dish-image-url" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">
                </div>
                <!-- Pricing -->
                <div class="pt-4 border-t grid grid-cols-1 md:grid-cols-2 gap-4">
                     <div>
                        <label for="edit-dish-price" class="block text-sm font-medium text-gray-700" data-lang="selling_price">Giá Bán Hiện Tại</label>
                        <input type="number" id="edit-dish-price" min="0" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">
                    </div>
                     <div>
                        <label for="edit-dish-price-effective-date" class="block text-sm font-medium text-gray-700" data-lang="price_effective_date">Ngày Áp Dụng Giá Mới</label>
                        <input type="date" id="edit-dish-price-effective-date" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3" min="1900-01-01" max="2999-12-31">
                    </div>
                </div>
                <!-- BOM Section -->
                <div class="pt-4 border-t">
                    <h3 class="text-lg font-medium text-gray-800 mb-2" data-lang="bom_title">Định Lượng Nguyên Liệu (BOM)</h3>
                    <div class="flex gap-2 items-center">
                        <select id="edit-bom-material-select" class="flex-grow border border-gray-300 rounded-md shadow-sm py-2 px-3"></select>
                        <input type="number" id="edit-bom-quantity" data-lang-placeholder="quantity_short" placeholder="SL" class="w-20 border border-gray-300 rounded-md shadow-sm py-2 px-3">
                        <button type="button" id="edit-add-bom-item-btn" class="bg-gray-600 text-white px-3 py-2 rounded-md hover:bg-gray-700">+</button>
                    </div>
                    <div id="edit-bom-items-list" class="mt-2 space-y-1"></div>
                    <div class="mt-2 font-semibold text-right"><span data-lang="estimated_cost">Giá vốn ước tính</span>: <span id="edit-estimated-cost">0 VND</span></div>
                </div>
                <div>
                    <label class="block text-sm font-medium" data-lang="adjustment_reason">Lý do điều chỉnh</label>
                    <textarea id="edit-dish-reason" required rows="2" class="mt-1 w-full border-gray-300 rounded-md py-2 px-3"></textarea>
                </div>
            </form>
             <div class="flex justify-end gap-4 mt-6 pt-4 border-t">
                <button type="button" id="cancel-edit-dish" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-md" data-lang="cancel_btn">Hủy</button>
                <button type="submit" form="edit-dish-form" class="bg-blue-600 text-white px-4 py-2 rounded-md" data-lang="save_changes_btn">Lưu Thay Đổi</button>
            </div>
        </div>
    </div>
    
    <!-- Edit Material Modal -->
    <div id="edit-material-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg">
            <h2 class="text-2xl font-bold mb-4" data-lang="edit_material_title">Điều Chỉnh Thông Tin Nguyên Vật Liệu</h2>
            <form id="edit-material-form" class="space-y-4">
                <input type="hidden" id="edit-material-id">
                 <div>
                    <label class="block text-sm font-medium" data-lang="material_name">Tên nguyên liệu</label>
                    <input type="text" id="edit-material-name" required class="mt-1 w-full border-gray-300 rounded-md py-2 px-3">
                </div>
                <div>
                    <label class="block text-sm font-medium" data-lang="unit">Đơn vị</label>
                    <input type="text" id="edit-material-unit" required class="mt-1 w-full border-gray-300 rounded-md py-2 px-3">
                </div>
                <div>
                    <label class="block text-sm font-medium" data-lang="min_stock_level">Mức tồn kho tối thiểu</label>
                    <input type="number" id="edit-material-min-stock" required class="mt-1 w-full border-gray-300 rounded-md py-2 px-3">
                </div>
                <div>
                    <label class="block text-sm font-medium" data-lang="category">Phân loại</label>
                    <select id="edit-material-category-select" class="w-full border border-gray-300 rounded-md py-2 px-3"></select>
                </div>
                 <div>
                    <label class="block text-sm font-medium" data-lang="adjustment_reason">Lý do điều chỉnh</label>
                    <textarea id="edit-material-reason" required rows="2" class="mt-1 w-full border-gray-300 rounded-md py-2 px-3"></textarea>
                </div>
                <div class="flex justify-end gap-4 mt-6">
                    <button type="button" id="cancel-edit-material" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-md" data-lang="cancel_btn">Hủy</button>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md" data-lang="save_changes_btn">Lưu Thay Đổi</button>
                </div>
            </form>
        </div>
    </div>

     <!-- Edit Category Modal -->
    <div id="edit-category-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg">
            <h2 class="text-2xl font-bold mb-4" data-lang="edit_category_title">Chỉnh Sửa Phân Loại</h2>
            <form id="edit-category-form" class="space-y-4">
                <input type="hidden" id="edit-category-id">
                <div>
                    <label class="block text-sm font-medium" data-lang="category_name">Tên phân loại</label>
                    <input type="text" id="edit-category-name" required class="mt-1 w-full border-gray-300 rounded-md py-2 px-3">
                </div>
                <div class="flex justify-end gap-4 mt-6">
                    <button type="button" id="cancel-edit-category" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-md" data-lang="cancel_btn">Hủy</button>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md" data-lang="save_changes_btn">Lưu</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Generic Confirmation Modal -->
    <div id="confirmation-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm">
            <h2 id="confirmation-title" class="text-xl font-bold mb-4">Xác nhận</h2>
            <p id="confirmation-message" class="mb-6">Bạn có chắc chắn muốn thực hiện hành động này?</p>
            <div class="flex justify-end gap-4">
                <button id="confirm-cancel-btn" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-md">Hủy</button>
                <button id="confirm-ok-btn" class="bg-red-600 text-white px-4 py-2 rounded-md">Đồng ý</button>
            </div>
        </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        /**
         * LƯU Ý QUAN TRỌNG:
         * Hệ thống này hiện đang sử dụng localStorage để lưu trữ dữ liệu.
         * Đây là giải pháp phù hợp cho mục đích demo và sử dụng trên một máy tính duy nhất.
         * Để triển khai trong môi trường thực tế với nhiều người dùng, cần thay thế
         * localStorage bằng một cơ sở dữ liệu chuyên dụng như Firebase, Supabase, hoặc một backend tự xây dựng.
        */
        
        const translations = {
            vi: {
                dashboard_title: 'Bảng Điều Khiển',
                dashboard_overview: 'Tổng Quan',
                today_revenue: 'Doanh thu hôm nay',
                today_orders: 'Đơn hàng mới',
                best_selling_dish: 'Món bán chạy nhất',
                low_stock_alert: 'Cảnh báo tồn kho',
                order_status_distribution: 'Phân bổ Trạng thái Đơn hàng',
                recent_activity: 'Hoạt động Gần đây',
                employee_management: 'Quản Lý Nhân Viên',
                order_lookup: 'Tra Cứu Đơn Hàng',
                menu_management: 'Quản Lý Thực Đơn',
                supplier_management: 'Nhà Cung Cấp',
                material_management: 'Nguyên Vật Liệu',
                spoilage_management: 'Quản Lý Hư Hao',
                other_costs: 'Chi Phí Khác',
                profit_report: 'Báo Cáo Lợi Nhuận',
                inventory_report: 'Báo Cáo Tồn Kho',
                adjustment_logs: 'Lịch Sử Điều Chỉnh',
                employee_management_title: 'Quản Lý Nhân Viên',
                add_new_employee: 'Thêm Nhân Viên Mới',
                employee_id_code: 'Mã số nhân viên',
                employee_name: 'Họ và Tên',
                employee_dob: 'Ngày sinh',
                employee_nid: 'Số CCCD/CC',
                employee_photo_url: 'URL Hình ảnh',
                employee_photo_url_placeholder: 'https://example.com/photo.jpg',
                employee_permanent_address: 'Địa chỉ thường trú',
                employee_current_address: 'Địa chỉ hiện tại',
                employee_start_date: 'Ngày nhận việc',
                employee_type: 'Hình thức làm việc',
                employee_type_part_time: 'Bán thời gian',
                employee_type_contract: 'Hợp đồng lao động',
                roles: 'Vai trò',
                add_employee_btn: 'Thêm Nhân Viên',
                employee_list: 'Danh Sách Nhân Viên',
                employee_details_title: 'Thông Tin Chi Tiết Nhân Viên',
                terminate_employee_btn: 'Thôi việc',
                terminate_employee_title: 'Chấm Dứt Hợp Đồng',
                termination_date: 'Ngày thôi việc',
                termination_reason: 'Lý do thôi việc',
                confirm_termination_btn: 'Xác nhận thôi việc',
                employee_status: 'Trạng thái',
                status_active: 'Đang làm việc',
                status_terminated: 'Đã thôi việc',
                view_details: 'Xem chi tiết',
                role_taker: 'Nhận Đơn',
                role_kitchen: 'Bếp',
                role_shipper: 'Giao Hàng',
                order_lookup_title: 'Tra Cứu Đơn Hàng',
                view_by: 'Xem theo',
                this_month: 'Tháng này',
                this_quarter: 'Quí này',
                this_year: 'Năm này',
                custom_option: 'Tùy chọn',
                from_date: 'Từ ngày',
                to_date: 'Đến ngày',
                search_btn: 'Tra cứu',
                order_list: 'Danh sách Đơn Hàng',
                status_new: 'Đơn mới',
                status_preparing: 'Đang chuẩn bị',
                status_delivering: 'Đang giao',
                status_completed: 'Hoàn thành',
                status_cancelled: 'Đã hủy',
                menu_management_title: 'Quản Lý Thực Đơn & Định Lượng (BOM)',
                add_new_dish: 'Thêm Món Mới',
                dish_name: 'Tên món',
                description: 'Mô tả',
                selling_price: 'Giá Bán (VND)',
                image_url: 'URL Hình ảnh',
                bom_title: 'Định Lượng Nguyên Liệu (BOM)',
                quantity_short: 'SL',
                estimated_cost: 'Giá vốn ước tính',
                add_dish_btn: 'Thêm Món',
                current_dishes_list: 'Danh Sách Món Ăn Hiện Có',
                supplier_management_title: 'Quản Lý Nhà Cung Cấp',
                add_new_supplier: 'Thêm NCC Mới',
                supplier_name: 'Tên nhà cung cấp',
                contact_person: 'Người liên hệ',
                phone_number: 'Số điện thoại',
                address: 'Địa chỉ',
                tax_code: 'Mã số thuế (nếu có)',
                add_supplier_btn: 'Thêm NCC',
                suppliers_list_title: 'Danh Sách Nhà Cung Cấp',
                purchase_management_title: 'Nguyên Vật Liệu & Nhập Kho',
                define_material: 'Định Nghĩa Nguyên Vật Liệu',
                material_name: 'Tên nguyên liệu',
                unit_placeholder: 'Đơn vị (kg, gr, cái)',
                add_btn: 'Thêm',
                materials_list_title: 'Danh Sách Nguyên Vật Liệu',
                record_purchase: 'Nhập Kho',
                purchase_date: 'Ngày nhập hàng',
                material: 'Nguyên liệu',
                quantity: 'Số lượng',
                unit: 'Đơn vị',
                total_price: 'Tổng tiền (VND)',
                supplier: 'Nhà cung cấp',
                new_unit_price_label: 'Đơn giá mới sẽ là',
                confirm_purchase_btn: 'Xác Nhận Nhập Kho',
                purchase_history_title: 'Lịch Sử Nhập Kho',
                spoilage_management_title: 'Quản Lý Nguyên Vật Liệu Hư Hao',
                record_spoilage: 'Ghi Nhận Hư Hao',
                spoilage_date: 'Ngày thải bỏ',
                spoilage_reason: 'Nguyên nhân thải bỏ',
                spoilage_reason_placeholder: 'VD: Hết hạn, hỏng...',
                record_btn: 'Ghi Nhận',
                spoilage_history_title: 'Lịch Sử Hư Hao',
                other_costs_title: 'Quản Lý Chi Phí Khác',
                add_new_cost: 'Thêm Chi Phí Mới',
                cost_name: 'Tên chi phí',
                amount: 'Số tiền (VND)',
                cost_type: 'Loại chi phí',
                monthly: 'Hàng tháng',
                yearly: 'Hàng năm',
                onetime: 'Một lần (Đầu tư)',
                add_cost_btn: 'Thêm Chi Phí',
                monthly_costs: 'Chi phí hàng tháng',
                total_monthly: 'Tổng cộng tháng:',
                yearly_costs: 'Chi phí hàng năm',
                total_yearly: 'Tổng cộng năm:',
                onetime_costs: 'Chi phí một lần (Đầu tư)',
                total: 'Tổng cộng:',
                profit_report_title: 'Báo Cáo Lợi Nhuận',
                calculate_profit_btn: 'Xem Báo Cáo',
                business_results_period: 'Kết Quả Kinh Doanh Trong Kỳ',
                total_revenue: 'Tổng Doanh Thu:',
                total_cogs: 'Tổng Giá Vốn Hàng Bán:',
                total_commission_fees: 'Tổng Phí Chiết Khấu:',
                total_operating_expenses: 'Tổng Chi Phí Hoạt Động (Tháng):',
                spoilage_cost: 'Chi Phí Hư Hao (Ước Tính):',
                net_profit: 'Lợi Nhuận Ròng (Trước Thuế):',
                revenue_structure: 'Cơ cấu doanh thu',
                inventory_report_title: 'Báo Cáo Xuất Nhập Tồn Nguyên Liệu',
                view_report_btn: 'Xem Báo Cáo',
                material_name_header: 'Tên Nguyên Liệu',
                unit_header: 'ĐVT',
                opening_stock: 'Tồn Đầu Kỳ',
                purchased_in_period: 'Nhập Trong Kỳ',
                used_in_period: 'Xuất Trong Kỳ (Bán)',
                spoiled_in_period: 'Hư Hao Trong Kỳ',
                closing_stock: 'Tồn Cuối Kỳ',
                adjustment_logs_title: 'Lịch Sử Điều Chỉnh Dữ Liệu',
                cancel_btn: 'Hủy',
                save_changes_btn: 'Lưu Thay Đổi',
                edit: 'Sửa',
                delete: 'Xóa',
                empty_data: 'Chưa có dữ liệu.',
                empty_adjustment_logs: 'Chưa có lịch sử điều chỉnh nào.',
                select_material: 'Chọn nguyên liệu',
                select_supplier: 'Chọn NCC',
                log_type_supplier: 'Nhà Cung Cấp',
                log_type_purchase: 'Nhập kho',
                log_type_dish: 'Món Ăn',
                log_type_material: 'Nguyên Vật Liệu',
                edit_supplier_title: 'Điều Chỉnh Thông Tin Nhà Cung Cấp',
                supplier_name_label: 'Tên nhà cung cấp',
                tax_code_label: 'Mã số thuế',
                adjustment_reason: 'Lý do điều chỉnh',
                edit_purchase_title: 'Điều Chỉnh Dữ Liệu Nhập Kho',
                edit_dish_title: 'Điều Chỉnh Thông Tin Món Ăn',
                price_effective_date: 'Ngày Áp Dụng Giá Mới',
                edit_material_title: 'Điều Chỉnh Thông Tin Nguyên Vật Liệu',
                total_time: 'Tổng thời gian',
                duration: 'Thời gian trôi qua',
                material_categories: 'Phân loại Nguyên vật liệu',
                category_name_placeholder: 'Tên phân loại mới',
                search_material_placeholder: 'Tìm kiếm nguyên vật liệu...',
                edit_category_title: 'Chỉnh Sửa Phân Loại',
                category_name: 'Tên phân loại',
                category: 'Phân loại',
                uncategorized: 'Chưa phân loại',
                select_category: 'Chọn phân loại',
                min_stock_level: 'Mức tồn kho tối thiểu',
                min_stock_placeholder: 'Tồn kho tối thiểu',
                payroll_management: 'Quản Lý Lương',
                payroll_management_title: 'Chấm Công & Tính Lương',
                salary_history: 'Lịch Sử Lương',
                current_salary: 'Mức lương hiện tại',
                add_new_salary: 'Thêm mức lương mới',
                new_salary_rate: 'Mức lương mới',
                effective_date: 'Ngày hiệu lực',
                save_salary_btn: 'Lưu Lương',
                salary_per_hour: 'lương/giờ',
                salary_per_month: 'lương/tháng',
                timesheet_for_month: 'Bảng Chấm Công Tháng',
                load_timesheet_data: 'Tải Dữ Liệu',
                employee: 'Nhân viên',
                salary_rate: 'Mức lương',
                hours_worked: 'Giờ làm việc',
                performance_bonus: 'Thưởng/Phạt (VND)',
                calculate_payroll: 'Tính Lương',
                payroll_results_for: 'Bảng Lương Tháng',
                gross_salary: 'Lương Gộp',
                social_insurance: 'BHXH (8%)',
                health_insurance: 'BHYT (1.5%)',
                unemployment_insurance: 'BHTN (1%)',
                total_deductions: 'Tổng khấu trừ',
                net_salary: 'Lương Thực Lĩnh',
                salary_for_insurance: 'Lương đóng bảo hiểm',
                confirm_delete_title: 'Xác nhận xóa',
                confirm_delete_msg: 'Bạn có chắc chắn muốn xóa mục này?',
                toast_add_success: 'Thêm thành công!',
                toast_update_success: 'Cập nhật thành công!',
                toast_delete_success: 'Xóa thành công!',
                toast_error: 'Có lỗi xảy ra!',
            },
            zh: { /* Translations in Chinese */ }
        };

        let currentLang = localStorage.getItem('language') || 'vi';
        let salesDataInPeriod = [];
        let editingBomItems = []; 
        let chartInstances = {};

        // --- Helper Functions ---
        const formatCurrency = (amount) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount || 0);
        const findById = (arr, id) => arr.find(item => item.id === parseInt(id));
        const todayISO = () => new Date().toISOString().split('T')[0];
        
        const loadFromStorage = (key, defaultValue = []) => {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (e) {
                console.error(`Error parsing ${key} from localStorage`, e);
                return defaultValue;
            }
        };

        const formatDuration = (ms) => {
            if (!ms || ms < 0) return '00:00:00';
            const totalSeconds = Math.floor(ms / 1000);
            const hours = Math.floor(totalSeconds / 3600).toString().padStart(2, '0');
            const minutes = Math.floor((totalSeconds % 3600) / 60).toString().padStart(2, '0');
            const seconds = (totalSeconds % 60).toString().padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
        };

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast-notification');
            toast.textContent = message;
            toast.className = '';
            toast.classList.add(type);
            toast.classList.remove('hidden');
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // --- Data Initialization ---
        let dishes = loadFromStorage('dishes');
        let rawMaterials = loadFromStorage('rawMaterials');
        let suppliers = loadFromStorage('suppliers');
        let purchases = loadFromStorage('purchases');
        let spoilageRecords = loadFromStorage('spoilageRecords');
        let adjustmentLogs = loadFromStorage('adjustmentLogs', []);
        let employees = loadFromStorage('employees');
        let otherCosts = loadFromStorage('otherCosts');
        let materialCategories = loadFromStorage('materialCategories');
        let timesheets = loadFromStorage('timesheets', {});

        // --- Constants and Enums ---
        const orderStatuses = {
            'new': { name: 'Đơn mới', name_zh: '新訂單', color: '#3B82F6' },
            'preparing': { name: 'Đang chuẩn bị', name_zh: '準備中', color: '#F97316' },
            'delivering': { name: 'Đang giao', name_zh: '配送中', color: '#8B5CF6' },
            'completed': { name: 'Hoàn thành', name_zh: '已完成', color: '#10B981' },
            'cancelled': { name: 'Đã hủy', name_zh: '已取消', color: '#EF4444' }
        };
        const employeeRoles = { 'taker': { name: 'Nhận Đơn' }, 'kitchen': { name: 'Bếp' }, 'shipper': { name: 'Giao Hàng' } };
        const employmentTypes = { 'part-time': {name: 'Bán thời gian'}, 'contract': {name: 'Hợp đồng lao động'} };
        
        // --- DOM Elements ---
        const elements = {
            // Modals
            confirmationModal: document.getElementById('confirmation-modal'),
            // Forms
            addSpoilageForm: document.getElementById('add-spoilage-form'),
            addOtherCostForm: document.getElementById('add-other-cost-form'),
            addPurchaseForm: document.getElementById('add-purchase-form'),
            // Buttons
            calculateProfitBtn: document.getElementById('calculate-profit-btn'),
            viewInventoryReportBtn: document.getElementById('view-inventory-report-btn'),
            // Date filters
            orderLookupStartDate: document.getElementById('order-lookup-start-date'),
            orderLookupEndDate: document.getElementById('order-lookup-end-date'),
            reportStartDate: document.getElementById('report-start-date'),
            reportEndDate: document.getElementById('report-end-date'),
            profitReportStartDate: document.getElementById('profit-report-start-date'),
            profitReportEndDate: document.getElementById('profit-report-end-date'),
            payrollMonthInput: document.getElementById('payroll-month'),
            // Date preset filters
            orderLookupPresetFilter: document.getElementById('order-lookup-preset-filter'),
            inventoryReportPresetFilter: document.getElementById('report-preset-filter'),
            profitReportPresetFilter: document.getElementById('profit-report-preset-filter'),
        };

        // ... [The rest of the JS code remains largely the same, but with the fixes integrated] ...

        // Example of a fixed/enhanced function:
        function renderDashboard() {
            const todayStart = new Date();
            todayStart.setHours(0,0,0,0);
            const todayEnd = new Date();
            todayEnd.setHours(23,59,59,999);
            
            const completedOrders = loadFromStorage('completedOrders');
            const activeOrders = loadFromStorage('activeOrders');
            
            const todaysCompleted = completedOrders.filter(o => new Date(o.timestamps.completed) >= todayStart && new Date(o.timestamps.completed) <= todayEnd);
            const todaysActive = activeOrders.filter(o => new Date(o.timestamps.created) >= todayStart);
            const todaysOrders = [...todaysCompleted, ...todaysActive];

            // Card 1: Revenue
            const todayRevenue = todaysCompleted.reduce((sum, order) => sum + order.total, 0);
            document.getElementById('dashboard-revenue').textContent = formatCurrency(todayRevenue);

            // Card 2: Orders
            document.getElementById('dashboard-orders').textContent = todaysOrders.length;

            // Card 3: Best Seller
            const dishCounts = {};
            todaysOrders.forEach(order => {
                order.items.forEach(item => {
                    dishCounts[item.dishId] = (dishCounts[item.dishId] || 0) + item.quantity;
                });
            });
            const bestSellerId = Object.keys(dishCounts).sort((a,b) => dishCounts[b] - dishCounts[a])[0];
            const bestSeller = bestSellerId ? findById(dishes, bestSellerId)?.name : 'N/A';
            document.getElementById('dashboard-best-seller').textContent = bestSeller;

            // Card 4: Low Stock Alert
            let lowStockCount = 0;
            rawMaterials.forEach(material => {
                const currentStock = calculateCurrentStock(material.id);
                if (currentStock < material.minStock) {
                    lowStockCount++;
                }
            });
            document.getElementById('dashboard-low-stock').textContent = lowStockCount;

            // Chart
            const statusCounts = todaysActive.reduce((acc, order) => {
                acc[order.status] = (acc[order.status] || 0) + 1;
                return acc;
            }, {});
            statusCounts.completed = todaysCompleted.length;
            
            const allStatuses = {...orderStatuses};
            const chartLabels = Object.keys(allStatuses).map(key => allStatuses[key][`name${currentLang === 'zh' ? '_zh' : ''}`] || allStatuses[key].name);
            const chartDataValues = Object.keys(allStatuses).map(key => statusCounts[key] || 0);
            const chartColors = Object.values(allStatuses).map(s => s.color);

            const chartData = {
                labels: chartLabels,
                datasets: [{ data: chartDataValues, backgroundColor: chartColors }]
            };
            
            const ctx = document.getElementById('orderStatusChart').getContext('2d');
            if (chartInstances.orderStatus) chartInstances.orderStatus.destroy();
            chartInstances.orderStatus = new Chart(ctx, {
                type: 'doughnut',
                data: chartData,
                options: { responsive: true, maintainAspectRatio: false, legend: { position: 'bottom' } }
            });

            // Recent Activity
            renderRecentActivity();
        }
        
        // --- New Functions for Fixes ---
        function calculateCurrentStock(materialId) {
            const totalPurchased = purchases
                .filter(p => p.materialId === materialId)
                .reduce((sum, p) => sum + p.quantity, 0);
            const totalSpoiled = spoilageRecords
                .filter(s => s.materialId === materialId)
                .reduce((sum, s) => sum + s.quantity, 0);
            const allCompletedOrders = loadFromStorage('completedOrders');
            const totalUsed = getMaterialUsage(allCompletedOrders)[materialId] || 0;
            return totalPurchased - totalSpoiled - totalUsed;
        }

        document.getElementById('add-material-form').addEventListener('submit', e => {
            e.preventDefault();
            const newMaterial = {
                id: Date.now(),
                name: document.getElementById('material-name').value.trim(),
                unit: document.getElementById('material-unit').value.trim(),
                minStock: parseFloat(document.getElementById('material-min-stock').value) || 0,
                categoryId: parseInt(document.getElementById('material-category-select').value) || null,
                price: 0
            };
            rawMaterials.push(newMaterial);
            localStorage.setItem('rawMaterials', JSON.stringify(rawMaterials));
            showToast(translations[currentLang].toast_add_success);
            renderMaterialsList();
            e.target.reset();
        });
        
         document.getElementById('edit-material-form').addEventListener('submit', e => {
            e.preventDefault();
            const materialId = parseInt(document.getElementById('edit-material-id').value);
            const updatedMaterial = {
                ...findById(rawMaterials, materialId),
                name: document.getElementById('edit-material-name').value,
                unit: document.getElementById('edit-material-unit').value,
                minStock: parseFloat(document.getElementById('edit-material-min-stock').value) || 0,
                categoryId: parseInt(document.getElementById('edit-material-category-select').value) || null
            };
            rawMaterials = rawMaterials.map(m => m.id === materialId ? updatedMaterial : m);
            localStorage.setItem('rawMaterials', JSON.stringify(rawMaterials));
            document.getElementById('edit-material-modal').classList.remove('active');
            showToast(translations[currentLang].toast_update_success);
            renderApp();
        });
        
        function renderRecentActivity() {
            const activityEl = document.getElementById('dashboard-recent-activity');
            const recentLogs = [...adjustmentLogs].slice(0, 10);
            if (recentLogs.length === 0) {
                activityEl.innerHTML = `<p class="text-gray-500 text-sm">${translations[currentLang].empty_adjustment_logs}</p>`;
                return;
            }
            activityEl.innerHTML = recentLogs.map(log => {
                const logType = translations[currentLang][log.typeKey] || log.typeKey;
                return `<div class="text-sm border-l-2 pl-2">
                            <p><span class="font-semibold">${logType}:</span> ${log.reason}</p>
                            <p class="text-xs text-gray-400">${new Date(log.date).toLocaleString('vi-VN')}</p>
                        </div>`;
            }).join('');
        }

        // --- FULL RENDER & INITIALIZATION ---
        function renderApp() {
            updateAllMaterialPrices();
            recalculateAllDishCosts();
            renderEmployeesList();
            renderSuppliersList();
            renderMaterialCategories();
            renderMaterialsList();
            renderSpoilageList();
            renderOtherCosts();
            document.getElementById('dishes-list').innerHTML = dishes.map(renderDish).join('');
            
            const rolesContainer = document.getElementById('employee-roles-checkboxes');
            if(rolesContainer) {
                rolesContainer.innerHTML = Object.keys(employeeRoles).map(key => `<label class="flex items-center"><input type="checkbox" name="employee-roles" value="${key}" class="h-4 w-4 text-indigo-600 border-gray-300 rounded"><span class="ml-2 text-gray-700">${employeeRoles[key].name}</span></label>`).join('');
            }
            
            populateMaterialSelects(document.getElementById('bom-material-select'));
            populateMaterialSelects(document.getElementById('purchase-material-select'));
            populateMaterialSelects(document.getElementById('spoilage-material-select'));
            populateSelect(document.getElementById('purchase-supplier-select'), suppliers, 'select_supplier');

            renderDashboard();
        }
        
        // --- Set default dates ---
        document.getElementById('purchase-date').value = todayISO();
        document.getElementById('spoilage-date').value = todayISO();
        elements.payrollMonthInput.value = new Date().toISOString().slice(0, 7);
        handleDatePresetChange('this_month', elements.orderLookupStartDate, elements.orderLookupEndDate);
        handleDatePresetChange('this_month', elements.reportStartDate, elements.reportEndDate);
        handleDatePresetChange('this_month', elements.profitReportStartDate, elements.profitReportEndDate);
        setLanguage(currentLang);

    });
    </script>
</body>
</html>

