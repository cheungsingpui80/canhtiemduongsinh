<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Qu·∫£n Tr·ªã - Canh Ti·ªÅm D∆∞·ª°ng Sinh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .tab-content, .modal {
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .lang-btn.active {
            background-color: #4f46e5;
            color: white;
        }
        .stat-card:hover {
             border-color: var(--status-color, #d1d5db); /* Default to gray-300 */
             transform: translateY(-2px);
             transition: all 0.2s ease-in-out;
        }
        .sidebar-link.active {
            background-color: #4a5568; /* a shade of gray */
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="w-64 bg-gray-800 text-white flex flex-col">
            <div class="px-8 py-6">
                <h2 class="text-2xl font-semibold" data-lang="dashboard_title">B·∫£ng ƒêi·ªÅu Khi·ªÉn</h2>
            </div>
             <!-- Language Switcher -->
            <div class="px-4 py-2">
                <div class="flex bg-gray-700 rounded-lg p-1">
                    <button class="lang-btn flex-1 text-sm py-1 px-2 rounded-md" data-lang-code="vi">Ti·∫øng Vi·ªát</button>
                    <button class="lang-btn flex-1 text-sm py-1 px-2 rounded-md" data-lang-code="zh">ÁπÅÈ´î‰∏≠Êñá</button>
                </div>
            </div>
            <nav class="flex-1 px-4 py-2 space-y-2 overflow-y-auto">
                <a href="#" class="tab-link active:bg-gray-700 bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="dashboard">
                    <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" /></svg>
                    <span data-lang="dashboard_overview">T·ªïng Quan</span>
                </a>
                 <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="employee-management">
                    <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-4.663M12 12A3 3 0 1012 6a3 3 0 000 6z" /></svg>
                    <span data-lang="employee_management">Qu·∫£n L√Ω Nh√¢n Vi√™n</span>
                </a>
                <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="sales-management">
                    <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c.51 0 .962-.343 1.087-.835l.383-1.437M7.5 14.25L5.106 5.165A2.25 2.25 0 002.854 3H2.25" />
                    </svg>
                    <span data-lang="order_lookup">Tra C·ª©u ƒê∆°n H√†ng</span>
                </a>
                <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="menu-management">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                    <span data-lang="menu_management">Qu·∫£n L√Ω Th·ª±c ƒê∆°n</span>
                </a>
                <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="supplier-management">
                     <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975m11.963 0a9 9 0 10-11.963 0m11.963 0A8.966 8.966 0 0112 21a8.966 8.966 0 01-5.982-2.275M15 9.75a3 3 0 11-6 0 3 3 0 016 0z" />
                     </svg>
                     <span data-lang="supplier_management">Nh√† Cung C·∫•p</span>
                </a>
                <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="purchase-management">
                     <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" /></svg>
                     <span data-lang="material_management">Nguy√™n V·∫≠t Li·ªáu</span>
                </a>
                <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="spoilage-management">
                    <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg>
                    <span data-lang="spoilage_management">Qu·∫£n L√Ω H∆∞ Hao</span>
                </a>
                <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="cost-management">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 8h6m-5 4h4m5 6H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2z"></path></svg>
                    <span data-lang="other_costs">Chi Ph√≠ Kh√°c</span>
                </a>
                <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="profit-report">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path></svg>
                    <span data-lang="profit_report">B√°o C√°o L·ª£i Nhu·∫≠n</span>
                </a>
                <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="inventory-report">
                    <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-1.621-1.621A3 3 0 0115 18.257V17.25m6-12V15a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 15V5.25A2.25 2.25 0 015.25 3h4.5M15 3.75a2.25 2.25 0 012.25 2.25V6a2.25 2.25 0 01-2.25 2.25H8.25A2.25 2.25 0 016 6V5.25a2.25 2.25 0 012.25-2.25h4.5M15 3.75h-4.5m0 0a2.25 2.25 0 012.25 2.25V6" />
                    </svg>
                    <span data-lang="inventory_report">B√°o C√°o T·ªìn Kho</span>
                </a>
                <a href="#" class="tab-link hover:bg-gray-700 flex items-center px-4 py-2 rounded-lg" data-tab="adjustment-logs">
                     <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
                    </svg>
                    <span data-lang="adjustment_logs">L·ªãch S·ª≠ ƒêi·ªÅu Ch·ªânh</span>
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <main class="flex-1 p-6 md:p-10 overflow-y-auto">
            
            <!-- Tab: Dashboard -->
            <div id="dashboard" class="tab-content active">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="dashboard_overview">T·ªïng Quan H√¥m Nay</h1>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Dashboard cards will be injected here -->
                    <div class="bg-white p-6 rounded-lg shadow-md flex items-center">
                        <div class="bg-blue-100 p-3 rounded-full mr-4"><svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01"></path></svg></div>
                        <div>
                            <p class="text-sm text-gray-500" data-lang="today_revenue">Doanh thu h√¥m nay</p>
                            <p id="dashboard-revenue" class="text-2xl font-bold">0 VND</p>
                        </div>
                    </div>
                     <div class="bg-white p-6 rounded-lg shadow-md flex items-center">
                        <div class="bg-green-100 p-3 rounded-full mr-4"><svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg></div>
                        <div>
                            <p class="text-sm text-gray-500" data-lang="today_orders">ƒê∆°n h√†ng m·ªõi</p>
                            <p id="dashboard-orders" class="text-2xl font-bold">0</p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md flex items-center">
                        <div class="bg-yellow-100 p-3 rounded-full mr-4"><svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path></svg></div>
                        <div>
                            <p class="text-sm text-gray-500" data-lang="best_selling_dish">M√≥n b√°n ch·∫°y nh·∫•t</p>
                            <p id="dashboard-best-seller" class="text-lg font-bold">N/A</p>
                        </div>
                    </div>
                     <div class="bg-white p-6 rounded-lg shadow-md flex items-center">
                        <div class="bg-red-100 p-3 rounded-full mr-4"><svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg></div>
                        <div>
                            <p class="text-sm text-gray-500" data-lang="low_stock_alert">C·∫£nh b√°o t·ªìn kho</p>
                            <p id="dashboard-low-stock" class="text-2xl font-bold">0</p>
                        </div>
                    </div>
                </div>
                <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold mb-4" data-lang="order_status_distribution">Ph√¢n b·ªï Tr·∫°ng th√°i ƒê∆°n h√†ng</h3>
                        <canvas id="orderStatusChart"></canvas>
                    </div>
                     <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold mb-4" data-lang="recent_activity">Ho·∫°t ƒë·ªông G·∫ßn ƒë√¢y</h3>
                        <div id="dashboard-recent-activity" class="space-y-3 max-h-60 overflow-y-auto"></div>
                    </div>
                </div>
            </div>

             <!-- Tab: Qu·∫£n L√Ω Nh√¢n Vi√™n -->
            <div id="employee-management" class="tab-content">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="employee_management_title">Qu·∫£n L√Ω Nh√¢n Vi√™n</h1>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h2 class="text-xl font-semibold mb-4" data-lang="add_new_employee">Th√™m Nh√¢n Vi√™n M·ªõi</h2>
                            <form id="add-employee-form" class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="employee-name" class="block text-sm font-medium text-gray-700" data-lang="employee_name">H·ªç v√† T√™n</label>
                                        <input type="text" id="employee-name" required class="mt-1 block w-full border-gray-300 rounded-md py-2 px-3">
                                    </div>
                                    <div>
                                        <label for="employee-id-code" class="block text-sm font-medium text-gray-700" data-lang="employee_id_code">M√£ s·ªë nh√¢n vi√™n</label>
                                        <input type="text" id="employee-id-code" required class="mt-1 block w-full border-gray-300 rounded-md py-2 px-3">
                                    </div>
                                    <div>
                                        <label for="employee-dob" class="block text-sm font-medium text-gray-700" data-lang="employee_dob">Ng√†y sinh</label>
                                        <input type="date" id="employee-dob" required class="mt-1 block w-full border-gray-300 rounded-md py-2 px-3">
                                    </div>
                                    <div>
                                        <label for="employee-nid" class="block text-sm font-medium text-gray-700" data-lang="employee_nid">S·ªë CCCD/CC</label>
                                        <input type="text" id="employee-nid" required class="mt-1 block w-full border-gray-300 rounded-md py-2 px-3">
                                    </div>
                                </div>
                                <div>
                                    <label for="employee-photo-url" class="block text-sm font-medium text-gray-700" data-lang="employee_photo_url">URL H√¨nh ·∫£nh</label>
                                    <input type="url" id="employee-photo-url" data-lang-placeholder="employee_photo_url_placeholder" placeholder="https://example.com/photo.jpg" class="mt-1 block w-full border-gray-300 rounded-md py-2 px-3">
                                </div>
                                 <div>
                                    <label for="employee-permanent-address" class="block text-sm font-medium text-gray-700" data-lang="employee_permanent_address">ƒê·ªãa ch·ªâ th∆∞·ªùng tr√∫</label>
                                    <input type="text" id="employee-permanent-address" required class="mt-1 block w-full border-gray-300 rounded-md py-2 px-3">
                                </div>
                                <div>
                                    <label for="employee-current-address" class="block text-sm font-medium text-gray-700" data-lang="employee_current_address">ƒê·ªãa ch·ªâ hi·ªán t·∫°i</label>
                                    <input type="text" id="employee-current-address" required class="mt-1 block w-full border-gray-300 rounded-md py-2 px-3">
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                     <div>
                                        <label for="employee-start-date" class="block text-sm font-medium text-gray-700" data-lang="employee_start_date">Ng√†y nh·∫≠n vi·ªác</label>
                                        <input type="date" id="employee-start-date" required class="mt-1 block w-full border-gray-300 rounded-md py-2 px-3">
                                    </div>
                                    <div>
                                        <label for="employee-type" class="block text-sm font-medium text-gray-700" data-lang="employee_type">H√¨nh th·ª©c l√†m vi·ªác</label>
                                        <select id="employee-type" required class="mt-1 block w-full border-gray-300 rounded-md py-2 px-3">
                                            <option value="part-time" data-lang="employee_type_part_time">B√°n th·ªùi gian</option>
                                            <option value="contract" data-lang="employee_type_contract">H·ª£p ƒë·ªìng lao ƒë·ªông</option>
                                        </select>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700" data-lang="roles">Vai tr√≤</label>
                                    <div id="employee-roles-checkboxes" class="mt-2 space-y-2">
                                        <!-- Checkboxes will be inserted here by JS -->
                                    </div>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700" data-lang="add_employee_btn">Th√™m Nh√¢n Vi√™n</button>
                            </form>
                        </div>
                    </div>
                    <div class="lg:col-span-2">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h2 class="text-xl font-semibold mb-4" data-lang="employee_list">Danh S√°ch Nh√¢n Vi√™n</h2>
                            <div id="employees-list" class="space-y-4 max-h-[80vh] overflow-y-auto"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Tra C·ª©u ƒê∆°n H√†ng -->
            <div id="sales-management" class="tab-content">
                 <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="order_lookup_title">Tra C·ª©u ƒê∆°n H√†ng</h1>
                 <div class="bg-white p-6 rounded-lg shadow-md">
                    <!-- Filters -->
                    <div class="flex flex-wrap items-center gap-4 mb-6 pb-6 border-b">
                        <div>
                            <label for="order-lookup-preset-filter" class="block text-sm font-medium text-gray-700" data-lang="view_by">Xem theo</label>
                            <select id="order-lookup-preset-filter" class="mt-1 block w-full md:w-auto border-gray-300 rounded-md shadow-sm">
                                <option value="this_month" data-lang="this_month">Th√°ng n√†y</option>
                                <option value="this_quarter" data-lang="this_quarter">Qu√≠ n√†y</option>
                                <option value="this_year" data-lang="this_year">NƒÉm n√†y</option>
                                <option value="custom" data-lang="custom_option">T√πy ch·ªçn</option>
                            </select>
                        </div>
                        <div>
                            <label for="order-lookup-start-date" class="block text-sm font-medium text-gray-700" data-lang="from_date">T·ª´ ng√†y</label>
                            <input type="date" id="order-lookup-start-date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label for="order-lookup-end-date" class="block text-sm font-medium text-gray-700" data-lang="to_date">ƒê·∫øn ng√†y</label>
                            <input type="date" id="order-lookup-end-date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div class="self-end">
                            <button id="order-lookup-btn" class="bg-blue-600 text-white py-2 px-5 rounded-md hover:bg-blue-700" data-lang="search_btn">Tra c·ª©u</button>
                        </div>
                    </div>
                    
                    <!-- Statistics Section -->
                    <div id="order-stats" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                        <!-- Stat cards will be injected here by JS -->
                    </div>

                    <!-- Order Details Section -->
                    <div id="order-details-container" class="mt-8">
                         <h3 id="order-details-title" class="text-xl font-semibold mb-4 hidden"></h3>
                         <div id="order-details-list" class="space-y-3 max-h-[50vh] overflow-y-auto"></div>
                    </div>
                </div>
            </div>

            <!-- Tab: Qu·∫£n L√Ω Th·ª±c ƒê∆°n -->
            <div id="menu-management" class="tab-content">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="menu_management_title">Qu·∫£n L√Ω Th·ª±c ƒê∆°n &amp; ƒê·ªãnh L∆∞·ª£ng (BOM)</h1>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Form th√™m m√≥n ƒÉn -->
                    <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold mb-4" data-lang="add_new_dish">Th√™m M√≥n M·ªõi</h2>
                        <form id="add-dish-form" class="space-y-4">
                            <!-- Basic Info -->
                            <div>
                                <div class="flex justify-between items-center">
                                     <label for="dish-name" class="block text-sm font-medium text-gray-700" data-lang="dish_name">T√™n m√≥n</label>
                                     <button type="button" id="suggest-name-btn" class="text-xs text-indigo-700 font-semibold py-1 hover:text-indigo-900 flex items-center">
                                        <span data-lang="suggest_dish_name_template">üí° G·ª£i √Ω (M·∫´u)</span>
                                    </button>
                                </div>
                                <input type="text" id="dish-name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">
                                <div id="dish-name-suggestions" class="mt-2 text-sm"></div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center">
                                    <label for="dish-description" class="block text-sm font-medium text-gray-700" data-lang="description">M√¥ t·∫£</label>
                                    <button type="button" id="suggest-description-btn" class="text-xs text-indigo-700 font-semibold py-1 hover:text-indigo-900 flex items-center">
                                        <span data-lang="suggest_description_template">üí° G·ª£i √Ω (M·∫´u)</span>
                                    </button>
                                </div>
                                <textarea id="dish-description" rows="4" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></textarea>
                            </div>
                            <div>
                                <label for="dish-price" class="block text-sm font-medium text-gray-700" data-lang="selling_price">Gi√° B√°n (VND)</label>
                                <input type="number" id="dish-price" min="0" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">
                            </div>
                             <div>
                                <label for="dish-image-url" class="block text-sm font-medium text-gray-700" data-lang="image_url">URL H√¨nh ·∫£nh</label>
                                <input type="text" id="dish-image-url" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">
                            </div>
                            <!-- BOM Section -->
                            <div class="pt-4 border-t">
                                <h3 class="text-lg font-medium text-gray-800 mb-2" data-lang="bom_title">ƒê·ªãnh L∆∞·ª£ng Nguy√™n Li·ªáu (BOM)</h3>
                                <div class="flex gap-2 items-center">
                                    <select id="bom-material-select" class="flex-grow border border-gray-300 rounded-md shadow-sm py-2 px-3"></select>
                                    <input type="number" id="bom-quantity" data-lang-placeholder="quantity_short" placeholder="SL" class="w-20 border border-gray-300 rounded-md shadow-sm py-2 px-3">
                                    <button type="button" id="add-bom-item-btn" class="bg-gray-600 text-white px-3 py-2 rounded-md hover:bg-gray-700">+</button>
                                </div>
                                <div id="bom-items-list" class="mt-2 space-y-1"></div>
                                <div class="mt-2 font-semibold text-right"><span data-lang="estimated_cost">Gi√° v·ªën ∆∞·ªõc t√≠nh</span>: <span id="estimated-cost">0 VND</span></div>
                            </div>
                            <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700" data-lang="add_dish_btn">Th√™m M√≥n</button>
                        </form>
                    </div>
                    <!-- Danh s√°ch m√≥n ƒÉn -->
                    <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold mb-4" data-lang="current_dishes_list">Danh S√°ch M√≥n ƒÇn Hi·ªán C√≥</h2>
                        <div id="dishes-list" class="space-y-4"></div>
                    </div>
                </div>
            </div>

            <!-- Tab: Qu·∫£n L√Ω Nh√† Cung C·∫•p -->
            <div id="supplier-management" class="tab-content">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="supplier_management_title">Qu·∫£n L√Ω Nh√† Cung C·∫•p</h1>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-1">
                             <h3 class="text-lg font-medium mb-2" data-lang="add_new_supplier">Th√™m NCC M·ªõi</h3>
                             <form id="add-supplier-form" class="space-y-4">
                                <input type="text" id="supplier-name" data-lang-placeholder="supplier_name" placeholder="T√™n nh√† cung c·∫•p" required class="block w-full border-gray-300 rounded-md py-2 px-3">
                                <input type="text" id="supplier-contact" data-lang-placeholder="contact_person" placeholder="Ng∆∞·ªùi li√™n h·ªá" class="block w-full border-gray-300 rounded-md py-2 px-3">
                                <input type="tel" id="supplier-phone" data-lang-placeholder="phone_number" placeholder="S·ªë ƒëi·ªán tho·∫°i" class="block w-full border-gray-300 rounded-md py-2 px-3">
                                <input type="text" id="supplier-address" data-lang-placeholder="address" placeholder="ƒê·ªãa ch·ªâ" class="block w-full border-gray-300 rounded-md py-2 px-3">
                                <input type="text" id="supplier-taxcode" data-lang-placeholder="tax_code" placeholder="M√£ s·ªë thu·∫ø (n·∫øu c√≥)" class="block w-full border-gray-300 rounded-md py-2 px-3">
                                <button type="submit" class="w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700" data-lang="add_supplier_btn">Th√™m NCC</button>
                            </form>
                        </div>
                        <div class="lg:col-span-2">
                             <h3 class="text-lg font-medium mb-2" data-lang="suppliers_list_title">Danh S√°ch Nh√† Cung C·∫•p</h3>
                             <div id="suppliers-list" class="mt-4 space-y-3 max-h-96 overflow-y-auto"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Nguy√™n V·∫≠t Li·ªáu Mua V√†o -->
            <div id="purchase-management" class="tab-content">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="purchase_management_title">Nguy√™n V·∫≠t Li·ªáu & Nh·∫≠p Kho</h1>
                 <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Column 1: Category Management -->
                    <div class="space-y-6 bg-white p-6 rounded-lg shadow-md">
                        <div>
                            <h3 class="text-lg font-medium mb-2" data-lang="material_categories">Ph√¢n lo·∫°i Nguy√™n v·∫≠t li·ªáu</h3>
                            <form id="add-category-form" class="flex gap-2 mb-4">
                                <input type="text" id="category-name" data-lang-placeholder="category_name_placeholder" placeholder="T√™n ph√¢n lo·∫°i m·ªõi" required class="flex-grow border border-gray-300 rounded-md py-2 px-3">
                                <button type="submit" class="bg-indigo-600 text-white px-4 rounded-md hover:bg-indigo-700" data-lang="add_btn">Th√™m</button>
                            </form>
                            <div id="material-categories-list" class="space-y-2 max-h-[200px] overflow-y-auto"></div>
                        </div>
                        <div class="border-t pt-4">
                            <h3 class="text-lg font-medium mb-2" data-lang="define_material">ƒê·ªãnh Nghƒ©a Nguy√™n V·∫≠t Li·ªáu</h3>
                            <form id="add-material-form" class="space-y-4">
                                <input type="text" id="material-name" data-lang-placeholder="material_name" placeholder="T√™n nguy√™n li·ªáu" required class="w-full border border-gray-300 rounded-md py-2 px-3">
                                <input type="text" id="material-unit" data-lang-placeholder="unit_placeholder" placeholder="ƒê∆°n v·ªã (kg, gr, c√°i)" required class="w-full border border-gray-300 rounded-md py-2 px-3">
                                <select id="material-category-select" class="w-full border border-gray-300 rounded-md py-2 px-3"></select>
                                <button type="submit" class="w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700" data-lang="add_btn">Th√™m Nguy√™n Li·ªáu</button>
                            </form>
                        </div>
                    </div>

                    <!-- Column 2: Materials List & Purchase History -->
                     <div class="space-y-6 bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-medium mb-2" data-lang="materials_list_title">Danh S√°ch Nguy√™n V·∫≠t Li·ªáu</h3>
                        <input type="text" id="search-material-input" data-lang-placeholder="search_material_placeholder" placeholder="T√¨m ki·∫øm nguy√™n v·∫≠t li·ªáu..." class="w-full border border-gray-300 rounded-md py-2 px-3 mb-4">
                        <div id="materials-list" class="space-y-4 max-h-[65vh] overflow-y-auto"></div>
                    </div>

                    <!-- Column 3: Record Purchases -->
                    <div class="space-y-6 bg-white p-6 rounded-lg shadow-md">
                        <div>
                            <h3 class="text-lg font-medium mb-2" data-lang="record_purchase">Nh·∫≠p Kho</h3>
                            <form id="add-purchase-form" class="space-y-4 p-4 border rounded-md">
                                <div>
                                    <label class="block text-sm font-medium" data-lang="purchase_date">Ng√†y nh·∫≠p h√†ng</label>
                                    <input type="date" id="purchase-date" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium" data-lang="material">Nguy√™n li·ªáu</label>
                                    <select id="purchase-material-select" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3"></select>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium" data-lang="quantity">S·ªë l∆∞·ª£ng</label>
                                        <input type="number" id="purchase-quantity" min="0" step="any" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium" data-lang="unit">ƒê∆°n v·ªã</label>
                                        <input type="text" id="purchase-unit" readonly class="mt-1 block w-full bg-gray-100 border border-gray-300 rounded-md py-2 px-3">
                                    </div>
                                </div>
                                 <div>
                                    <label class="block text-sm font-medium" data-lang="total_price">T·ªïng ti·ªÅn (VND)</label>
                                    <input type="number" id="purchase-total-price" min="0" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3">
                                </div>
                                 <div>
                                    <label class="block text-sm font-medium" data-lang="supplier">Nh√† cung c·∫•p</label>
                                    <select id="purchase-supplier-select" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3"></select>
                                </div>
                                <p class="text-right"><span data-lang="new_unit_price_label">ƒê∆°n gi√° m·ªõi s·∫Ω l√†</span>: <span id="new-unit-price" class="font-semibold">0 VND</span></p>
                                <button type="submit" class="w-full bg-green-600 text-white py-2 rounded-md hover:bg-green-700" data-lang="confirm_purchase_btn">X√°c Nh·∫≠n Nh·∫≠p Kho</button>
                            </form>
                        </div>
                         <div class="border-t pt-4">
                             <h3 class="text-lg font-semibold mb-2" data-lang="purchase_history_title">L·ªãch S·ª≠ Nh·∫≠p Kho</h3>
                             <div id="purchases-list" class="space-y-2 max-h-60 overflow-y-auto"></div>
                         </div>
                    </div>
                </div>
            </div>

             <!-- Tab: Qu·∫£n L√Ω H∆∞ Hao -->
            <div id="spoilage-management" class="tab-content">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="spoilage_management_title">Qu·∫£n L√Ω Nguy√™n V·∫≠t Li·ªáu H∆∞ Hao</h1>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Form for adding spoilage -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold mb-4" data-lang="record_spoilage">Ghi Nh·∫≠n H∆∞ Hao</h2>
                        <form id="add-spoilage-form" class="space-y-4">
                            <div>
                                <label for="spoilage-date" class="block text-sm font-medium text-gray-700" data-lang="spoilage_date">Ng√†y th·∫£i b·ªè</label>
                                <input type="date" id="spoilage-date" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3">
                            </div>
                            <div>
                                <label for="spoilage-material-select" class="block text-sm font-medium text-gray-700" data-lang="material">Nguy√™n li·ªáu</label>
                                <select id="spoilage-material-select" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3"></select>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="spoilage-quantity" class="block text-sm font-medium text-gray-700" data-lang="quantity">S·ªë l∆∞·ª£ng</label>
                                    <input type="number" id="spoilage-quantity" min="0" step="any" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700" data-lang="unit">ƒê∆°n v·ªã t√≠nh</label>
                                    <input type="text" id="spoilage-unit" readonly class="mt-1 block w-full bg-gray-100 border border-gray-300 rounded-md py-2 px-3">
                                </div>
                            </div>
                             <div>
                                <label for="spoilage-reason" class="block text-sm font-medium text-gray-700" data-lang="spoilage_reason">Nguy√™n nh√¢n th·∫£i b·ªè</label>
                                <input type="text" id="spoilage-reason" required data-lang-placeholder="spoilage_reason_placeholder" placeholder="VD: H·∫øt h·∫°n, h·ªèng..." class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3">
                            </div>
                            <button type="submit" class="w-full bg-red-600 text-white py-2 rounded-md hover:bg-red-700" data-lang="record_btn">Ghi Nh·∫≠n</button>
                        </form>
                    </div>
                    <!-- List of spoilage records -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold" data-lang="spoilage_history_title">L·ªãch S·ª≠ H∆∞ Hao</h2>
                             <button id="analyze-spoilage-btn" class="bg-indigo-600 text-white py-1 px-3 rounded-md text-sm hover:bg-indigo-700 flex items-center">
                                <span data-lang="analyze_spoilage_simple">üìà Ph√¢n t√≠ch ƒê∆°n gi·∫£n</span>
                            </button>
                        </div>
                        <div id="spoilage-list" class="space-y-2 max-h-80 overflow-y-auto"></div>
                        <div id="spoilage-analysis-result" class="mt-4 hidden p-4 bg-indigo-50 rounded-md"></div>
                    </div>
                </div>
            </div>

            <!-- Tab: Chi Ph√≠ Kh√°c -->
            <div id="cost-management" class="tab-content">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="other_costs_title">Qu·∫£n L√Ω Chi Ph√≠ Kh√°c</h1>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Add Cost Form -->
                    <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold mb-4" data-lang="add_new_cost">Th√™m Chi Ph√≠ M·ªõi</h2>
                        <form id="add-other-cost-form" class="space-y-4">
                            <div>
                                <label for="other-cost-name" class="block text-sm font-medium text-gray-700" data-lang="cost_name">T√™n chi ph√≠</label>
                                <input type="text" id="other-cost-name" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3">
                            </div>
                            <div>
                                <label for="other-cost-amount" class="block text-sm font-medium text-gray-700" data-lang="amount">S·ªë ti·ªÅn (VND)</label>
                                <input type="number" id="other-cost-amount" min="0" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3">
                            </div>
                            <div>
                                <label for="other-cost-frequency" class="block text-sm font-medium text-gray-700" data-lang="cost_type">Lo·∫°i chi ph√≠</label>
                                <select id="other-cost-frequency" required class="mt-1 block w-full border border-gray-300 rounded-md py-2 px-3">
                                    <option value="monthly" data-lang="monthly">H√†ng th√°ng</option>
                                    <option value="yearly" data-lang="yearly">H√†ng nƒÉm</option>
                                    <option value="onetime" data-lang="onetime">M·ªôt l·∫ßn (ƒê·∫ßu t∆∞)</option>
                                </select>
                            </div>
                            <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700" data-lang="add_cost_btn">Th√™m Chi Ph√≠</button>
                        </form>
                    </div>
                    <!-- Display Costs -->
                    <div class="lg:col-span-2 space-y-6">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold mb-3" data-lang="monthly_costs">Chi ph√≠ h√†ng th√°ng</h3>
                            <div id="monthly-costs-list" class="space-y-2"></div>
                            <div class="mt-4 pt-4 border-t font-bold flex justify-between">
                                <span data-lang="total_monthly">T·ªïng c·ªông th√°ng:</span><span id="total-monthly-costs">0 VND</span>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold mb-3" data-lang="yearly_costs">Chi ph√≠ h√†ng nƒÉm</h3>
                            <div id="yearly-costs-list" class="space-y-2"></div>
                             <div class="mt-4 pt-4 border-t font-bold flex justify-between">
                                <span data-lang="total_yearly">T·ªïng c·ªông nƒÉm:</span><span id="total-yearly-costs">0 VND</span>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold mb-3" data-lang="onetime_costs">Chi ph√≠ m·ªôt l·∫ßn (ƒê·∫ßu t∆∞)</h3>
                            <div id="onetime-costs-list" class="space-y-2"></div>
                             <div class="mt-4 pt-4 border-t font-bold flex justify-between">
                                <span data-lang="total">T·ªïng c·ªông:</span><span id="total-onetime-costs">0 VND</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: B√°o C√°o L·ª£i Nhu·∫≠n -->
            <div id="profit-report" class="tab-content">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="profit_report_title">B√°o C√°o L·ª£i Nhu·∫≠n</h1>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="flex flex-wrap items-center gap-4 mb-6 pb-6 border-b">
                         <div>
                            <label for="profit-report-preset-filter" class="block text-sm font-medium text-gray-700" data-lang="view_by">Xem theo</label>
                            <select id="profit-report-preset-filter" class="mt-1 block w-full md:w-auto border-gray-300 rounded-md shadow-sm">
                                <option value="this_month" data-lang="this_month">Th√°ng n√†y</option>
                                <option value="this_quarter" data-lang="this_quarter">Qu√≠ n√†y</option>
                                <option value="this_year" data-lang="this_year">NƒÉm n√†y</option>
                                <option value="custom" data-lang="custom_option">T√πy ch·ªçn</option>
                            </select>
                        </div>
                        <div>
                            <label for="profit-report-start-date" class="block text-sm font-medium text-gray-700" data-lang="from_date">T·ª´ ng√†y</label>
                            <input type="date" id="profit-report-start-date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label for="profit-report-end-date" class="block text-sm font-medium text-gray-700" data-lang="to_date">ƒê·∫øn ng√†y</label>
                            <input type="date" id="profit-report-end-date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div class="self-end">
                            <button id="calculate-profit-btn" class="w-full bg-green-600 text-white py-2 px-5 rounded-md hover:bg-green-700" data-lang="calculate_profit_btn">Xem B√°o C√°o</button>
                        </div>
                    </div>
                    <div id="profit-results" class="mt-8 pt-6 border-t hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="lg:col-span-2">
                                <h3 class="text-2xl font-semibold mb-4 text-center" data-lang="business_results_period">K·∫øt Qu·∫£ Kinh Doanh Trong K·ª≥</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-lg">
                                    <div class="bg-blue-50 p-4 rounded-md"><p class="text-gray-600" data-lang="total_revenue">T·ªïng Doanh Thu:</p><p id="result-revenue" class="font-bold text-2xl text-blue-700">0 VND</p></div>
                                    <div class="bg-orange-50 p-4 rounded-md"><p class="text-gray-600" data-lang="total_cogs">T·ªïng Gi√° V·ªën H√†ng B√°n:</p><p id="result-cogs" class="font-bold text-2xl text-orange-700">0 VND</p></div>
                                     <div class="bg-red-50 p-4 rounded-md"><p class="text-gray-600" data-lang="total_commission_fees">T·ªïng Ph√≠ Chi·∫øt Kh·∫•u:</p><p id="result-commission-fees" class="font-bold text-2xl text-red-700">0 VND</p></div>
                                    <div class="bg-yellow-50 p-4 rounded-md"><p class="text-gray-600" data-lang="total_operating_expenses">T·ªïng Chi Ph√≠ Ho·∫°t ƒê·ªông (Th√°ng):</p><p id="result-monthly-expense" class="font-bold text-2xl text-yellow-700">0 VND</p></div>
                                    <div class="bg-red-100 p-4 rounded-md"><p class="text-gray-600" data-lang="spoilage_cost">Chi Ph√≠ H∆∞ Hao (∆Ø·ªõc T√≠nh):</p><p id="result-spoilage-cost" class="font-bold text-2xl text-red-800">0 VND</p></div>
                                    <div class="bg-green-100 p-4 rounded-md"><p class="text-gray-600" data-lang="net_profit">L·ª£i Nhu·∫≠n R√≤ng (Tr∆∞·ªõc Thu·∫ø):</p><p id="result-net-profit" class="font-bold text-3xl text-green-800">0 VND</p></div>
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg">
                                <h3 class="text-lg font-semibold mb-4" data-lang="revenue_structure">C∆° c·∫•u doanh thu</h3>
                                <canvas id="revenueStructureChart"></canvas>
                            </div>
                        </div>

                        <div class="mt-8 text-center">
                            <button id="suggest-marketing-btn" class="bg-indigo-600 text-white py-2 px-5 rounded-md hover:bg-indigo-700 flex items-center justify-center mx-auto">
                                <span data-lang="view_marketing_suggestions">üí° Xem G·ª£i √Ω Marketing</span>
                            </button>
                            <div id="marketing-suggestions" class="mt-4 text-left hidden p-4 bg-indigo-50 rounded-lg"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tab: B√°o C√°o T·ªìn Kho -->
            <div id="inventory-report" class="tab-content">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="inventory_report_title">B√°o C√°o Xu·∫•t Nh·∫≠p T·ªìn Nguy√™n Li·ªáu</h1>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="flex flex-wrap items-center gap-4 mb-6 pb-6 border-b">
                        <div>
                            <label for="report-preset-filter" class="block text-sm font-medium text-gray-700" data-lang="view_by">Xem theo</label>
                            <select id="report-preset-filter" class="mt-1 block w-full md:w-auto border-gray-300 rounded-md shadow-sm">
                                <option value="this_month" data-lang="this_month">Th√°ng n√†y</option>
                                <option value="this_quarter" data-lang="this_quarter">Qu√≠ n√†y</option>
                                <option value="this_year" data-lang="this_year">NƒÉm n√†y</option>
                                <option value="custom" data-lang="custom_option">T√πy ch·ªçn</option>
                            </select>
                        </div>
                        <div>
                            <label for="report-start-date" class="block text-sm font-medium text-gray-700" data-lang="from_date">T·ª´ ng√†y</label>
                            <input type="date" id="report-start-date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label for="report-end-date" class="block text-sm font-medium text-gray-700" data-lang="to_date">ƒê·∫øn ng√†y</label>
                            <input type="date" id="report-end-date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div class="self-end">
                            <button id="view-inventory-report-btn" class="bg-blue-600 text-white py-2 px-5 rounded-md hover:bg-blue-700" data-lang="view_report_btn">Xem B√°o C√°o</button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-lang="material_name_header">T√™n Nguy√™n Li·ªáu</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-lang="unit_header">ƒêVT</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-lang="opening_stock">T·ªìn ƒê·∫ßu K·ª≥</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-lang="purchased_in_period">Nh·∫≠p Trong K·ª≥</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-lang="used_in_period">Xu·∫•t Trong K·ª≥ (B√°n)</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-lang="spoiled_in_period">H∆∞ Hao Trong K·ª≥</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-lang="closing_stock">T·ªìn Cu·ªëi K·ª≥</th>
                                </tr>
                            </thead>
                            <tbody id="inventory-report-body" class="bg-white divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Tab: L·ªãch s·ª≠ ƒëi·ªÅu ch·ªânh -->
            <div id="adjustment-logs" class="tab-content">
                <h1 class="text-3xl font-bold text-gray-800 mb-6" data-lang="adjustment_logs_title">L·ªãch S·ª≠ ƒêi·ªÅu Ch·ªânh D·ªØ Li·ªáu</h1>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div id="adjustment-logs-list" class="space-y-4"></div>
                </div>
            </div>

        </main>
    </div>

    <!-- Modals -->
    <div id="employee-details-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center overflow-y-auto p-4">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl max-h-[90vh] flex flex-col">
            <h2 class="text-2xl font-bold mb-4" data-lang="employee_details_title">Th√¥ng Tin Chi Ti·∫øt Nh√¢n Vi√™n</h2>
            <div id="employee-modal-content" class="overflow-y-auto pr-2">
                <!-- Details will be injected here -->
            </div>
             <div class="flex justify-end gap-4 mt-6 pt-4 border-t">
                <button type="button" id="close-employee-modal-btn" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-md" data-lang="cancel_btn">ƒê√≥ng</button>
            </div>
        </div>
    </div>
    <div id="edit-supplier-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center">
        <!-- ... (Modal content unchanged) ... -->
    </div>
    <div id="edit-purchase-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center">
        <!-- ... (Modal content unchanged) ... -->
    </div>

    <!-- Edit Dish Modal -->
    <div id="edit-dish-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg max-h-[90vh] flex flex-col">
            <h2 class="text-2xl font-bold mb-4" data-lang="edit_dish_title">ƒêi·ªÅu Ch·ªânh Th√¥ng Tin M√≥n ƒÇn</h2>
            <form id="edit-dish-form" class="space-y-4 overflow-y-auto pr-2">
                <input type="hidden" id="edit-dish-id">
                <!-- Basic Info -->
                <div>
                    <label for="edit-dish-name" class="block text-sm font-medium text-gray-700" data-lang="dish_name">T√™n m√≥n</label>
                    <input type="text" id="edit-dish-name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">
                </div>
                <div>
                    <label for="edit-dish-description" class="block text-sm font-medium text-gray-700" data-lang="description">M√¥ t·∫£</label>
                    <textarea id="edit-dish-description" rows="3" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></textarea>
                </div>
                <div>
                    <label for="edit-dish-image-url" class="block text-sm font-medium text-gray-700" data-lang="image_url">URL H√¨nh ·∫£nh</label>
                    <input type="text" id="edit-dish-image-url" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">
                </div>
                <!-- Pricing -->
                <div class="pt-4 border-t grid grid-cols-1 md:grid-cols-2 gap-4">
                     <div>
                        <label for="edit-dish-price" class="block text-sm font-medium text-gray-700" data-lang="selling_price">Gi√° B√°n Hi·ªán T·∫°i</label>
                        <input type="number" id="edit-dish-price" min="0" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">
                    </div>
                     <div>
                        <label for="edit-dish-price-effective-date" class="block text-sm font-medium text-gray-700" data-lang="price_effective_date">Ng√†y √Åp D·ª•ng Gi√° M·ªõi</label>
                        <input type="date" id="edit-dish-price-effective-date" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">
                    </div>
                </div>
                <!-- BOM Section -->
                <div class="pt-4 border-t">
                    <h3 class="text-lg font-medium text-gray-800 mb-2" data-lang="bom_title">ƒê·ªãnh L∆∞·ª£ng Nguy√™n Li·ªáu (BOM)</h3>
                    <div class="flex gap-2 items-center">
                        <select id="edit-bom-material-select" class="flex-grow border border-gray-300 rounded-md shadow-sm py-2 px-3"></select>
                        <input type="number" id="edit-bom-quantity" data-lang-placeholder="quantity_short" placeholder="SL" class="w-20 border border-gray-300 rounded-md shadow-sm py-2 px-3">
                        <button type="button" id="edit-add-bom-item-btn" class="bg-gray-600 text-white px-3 py-2 rounded-md hover:bg-gray-700">+</button>
                    </div>
                    <div id="edit-bom-items-list" class="mt-2 space-y-1"></div>
                    <div class="mt-2 font-semibold text-right"><span data-lang="estimated_cost">Gi√° v·ªën ∆∞·ªõc t√≠nh</span>: <span id="edit-estimated-cost">0 VND</span></div>
                </div>
                <div>
                    <label class="block text-sm font-medium" data-lang="adjustment_reason">L√Ω do ƒëi·ªÅu ch·ªânh</label>
                    <textarea id="edit-dish-reason" required rows="2" class="mt-1 w-full border-gray-300 rounded-md py-2 px-3"></textarea>
                </div>
            </form>
             <div class="flex justify-end gap-4 mt-6 pt-4 border-t">
                <button type="button" id="cancel-edit-dish" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-md" data-lang="cancel_btn">H·ªßy</button>
                <button type="submit" form="edit-dish-form" class="bg-blue-600 text-white px-4 py-2 rounded-md" data-lang="save_changes_btn">L∆∞u Thay ƒê·ªïi</button>
            </div>
        </div>
    </div>
    
    <!-- Edit Material Modal -->
    <div id="edit-material-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg">
            <h2 class="text-2xl font-bold mb-4" data-lang="edit_material_title">ƒêi·ªÅu Ch·ªânh Th√¥ng Tin Nguy√™n V·∫≠t Li·ªáu</h2>
            <form id="edit-material-form" class="space-y-4">
                <input type="hidden" id="edit-material-id">
                 <div>
                    <label class="block text-sm font-medium" data-lang="material_name">T√™n nguy√™n li·ªáu</label>
                    <input type="text" id="edit-material-name" required class="mt-1 w-full border-gray-300 rounded-md py-2 px-3">
                </div>
                <div>
                    <label class="block text-sm font-medium" data-lang="unit">ƒê∆°n v·ªã</label>
                    <input type="text" id="edit-material-unit" required class="mt-1 w-full border-gray-300 rounded-md py-2 px-3">
                </div>
                <div>
                    <label class="block text-sm font-medium" data-lang="category">Ph√¢n lo·∫°i</label>
                    <select id="edit-material-category-select" class="w-full border border-gray-300 rounded-md py-2 px-3"></select>
                </div>
                 <div>
                    <label class="block text-sm font-medium" data-lang="adjustment_reason">L√Ω do ƒëi·ªÅu ch·ªânh</label>
                    <textarea id="edit-material-reason" required rows="2" class="mt-1 w-full border-gray-300 rounded-md py-2 px-3"></textarea>
                </div>
                <div class="flex justify-end gap-4 mt-6">
                    <button type="button" id="cancel-edit-material" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-md" data-lang="cancel_btn">H·ªßy</button>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md" data-lang="save_changes_btn">L∆∞u Thay ƒê·ªïi</button>
                </div>
            </form>
        </div>
    </div>

     <!-- Edit Category Modal -->
    <div id="edit-category-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg">
            <h2 class="text-2xl font-bold mb-4" data-lang="edit_category_title">Ch·ªânh S·ª≠a Ph√¢n Lo·∫°i</h2>
            <form id="edit-category-form" class="space-y-4">
                <input type="hidden" id="edit-category-id">
                <div>
                    <label class="block text-sm font-medium" data-lang="category_name">T√™n ph√¢n lo·∫°i</label>
                    <input type="text" id="edit-category-name" required class="mt-1 w-full border-gray-300 rounded-md py-2 px-3">
                </div>
                <div class="flex justify-end gap-4 mt-6">
                    <button type="button" id="cancel-edit-category" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-md" data-lang="cancel_btn">H·ªßy</button>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md" data-lang="save_changes_btn">L∆∞u</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Generic Confirmation Modal -->
    <div id="confirmation-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm">
            <h2 id="confirmation-title" class="text-xl font-bold mb-4">X√°c nh·∫≠n</h2>
            <p id="confirmation-message" class="mb-6">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën th·ª±c hi·ªán h√†nh ƒë·ªông n√†y?</p>
            <div class="flex justify-end gap-4">
                <button id="confirm-cancel-btn" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-md">H·ªßy</button>
                <button id="confirm-ok-btn" class="bg-red-600 text-white px-4 py-2 rounded-md">ƒê·ªìng √Ω</button>
            </div>
        </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- IMPORTANT: Firebase Integration Placeholder ---
        // To make this a professional, real-world application, replace localStorage
        // with a real-time database like Google Firebase. The code below is structured
        // to make this transition easier. You would need to:
        // 1. Create a Firebase project at https://firebase.google.com/
        // 2. Enable Firestore Database and Authentication.
        // 3. Copy your Firebase config object here.
        // 4. Replace all `localStorage.getItem/setItem` calls with Firestore `getDoc/setDoc/onSnapshot` calls.
        
        const translations = {
            vi: {
                dashboard_title: 'B·∫£ng ƒêi·ªÅu Khi·ªÉn',
                dashboard_overview: 'T·ªïng Quan',
                today_revenue: 'Doanh thu h√¥m nay',
                today_orders: 'ƒê∆°n h√†ng m·ªõi',
                best_selling_dish: 'M√≥n b√°n ch·∫°y nh·∫•t',
                low_stock_alert: 'C·∫£nh b√°o t·ªìn kho',
                order_status_distribution: 'Ph√¢n b·ªï Tr·∫°ng th√°i ƒê∆°n h√†ng',
                recent_activity: 'Ho·∫°t ƒë·ªông G·∫ßn ƒë√¢y',
                employee_management: 'Qu·∫£n L√Ω Nh√¢n Vi√™n',
                order_lookup: 'Tra C·ª©u ƒê∆°n H√†ng',
                menu_management: 'Qu·∫£n L√Ω Th·ª±c ƒê∆°n',
                supplier_management: 'Nh√† Cung C·∫•p',
                material_management: 'Nguy√™n V·∫≠t Li·ªáu',
                spoilage_management: 'Qu·∫£n L√Ω H∆∞ Hao',
                other_costs: 'Chi Ph√≠ Kh√°c',
                profit_report: 'B√°o C√°o L·ª£i Nhu·∫≠n',
                inventory_report: 'B√°o C√°o T·ªìn Kho',
                adjustment_logs: 'L·ªãch S·ª≠ ƒêi·ªÅu Ch·ªânh',
                employee_management_title: 'Qu·∫£n L√Ω Nh√¢n Vi√™n',
                add_new_employee: 'Th√™m Nh√¢n Vi√™n M·ªõi',
                employee_id_code: 'M√£ s·ªë nh√¢n vi√™n',
                employee_name: 'H·ªç v√† T√™n',
                employee_dob: 'Ng√†y sinh',
                employee_nid: 'S·ªë CCCD/CC',
                employee_photo_url: 'URL H√¨nh ·∫£nh',
                employee_photo_url_placeholder: 'https://example.com/photo.jpg',
                employee_permanent_address: 'ƒê·ªãa ch·ªâ th∆∞·ªùng tr√∫',
                employee_current_address: 'ƒê·ªãa ch·ªâ hi·ªán t·∫°i',
                employee_start_date: 'Ng√†y nh·∫≠n vi·ªác',
                employee_type: 'H√¨nh th·ª©c l√†m vi·ªác',
                employee_type_part_time: 'B√°n th·ªùi gian',
                employee_type_contract: 'H·ª£p ƒë·ªìng lao ƒë·ªông',
                roles: 'Vai tr√≤',
                add_employee_btn: 'Th√™m Nh√¢n Vi√™n',
                employee_list: 'Danh S√°ch Nh√¢n Vi√™n',
                employee_details_title: 'Th√¥ng Tin Chi Ti·∫øt Nh√¢n Vi√™n',
                terminate_employee_btn: 'Th√¥i vi·ªác',
                terminate_employee_title: 'Ch·∫•m D·ª©t H·ª£p ƒê·ªìng',
                termination_date: 'Ng√†y th√¥i vi·ªác',
                termination_reason: 'L√Ω do th√¥i vi·ªác',
                confirm_termination_btn: 'X√°c nh·∫≠n th√¥i vi·ªác',
                employee_status: 'Tr·∫°ng th√°i',
                status_active: 'ƒêang l√†m vi·ªác',
                status_terminated: 'ƒê√£ th√¥i vi·ªác',
                view_details: 'Xem chi ti·∫øt',
                role_taker: 'Nh·∫≠n ƒê∆°n',
                role_kitchen: 'B·∫øp',
                role_shipper: 'Giao H√†ng',
                order_lookup_title: 'Tra C·ª©u ƒê∆°n H√†ng',
                view_by: 'Xem theo',
                this_month: 'Th√°ng n√†y',
                this_quarter: 'Qu√≠ n√†y',
                this_year: 'NƒÉm n√†y',
                custom_option: 'T√πy ch·ªçn',
                from_date: 'T·ª´ ng√†y',
                to_date: 'ƒê·∫øn ng√†y',
                search_btn: 'Tra c·ª©u',
                order_list: 'Danh s√°ch ƒê∆°n H√†ng',
                status_new: 'ƒê∆°n m·ªõi',
                status_preparing: 'ƒêang chu·∫©n b·ªã',
                status_delivering: 'ƒêang giao',
                status_completed: 'Ho√†n th√†nh',
                status_cancelled: 'ƒê√£ h·ªßy',
                menu_management_title: 'Qu·∫£n L√Ω Th·ª±c ƒê∆°n & ƒê·ªãnh L∆∞·ª£ng (BOM)',
                add_new_dish: 'Th√™m M√≥n M·ªõi',
                dish_name: 'T√™n m√≥n',
                suggest_dish_name_template: 'üí° G·ª£i √Ω (M·∫´u)',
                description: 'M√¥ t·∫£',
                suggest_description_template: 'üí° G·ª£i √Ω (M·∫´u)',
                selling_price: 'Gi√° B√°n (VND)',
                image_url: 'URL H√¨nh ·∫£nh',
                bom_title: 'ƒê·ªãnh L∆∞·ª£ng Nguy√™n Li·ªáu (BOM)',
                quantity_short: 'SL',
                estimated_cost: 'Gi√° v·ªën ∆∞·ªõc t√≠nh',
                add_dish_btn: 'Th√™m M√≥n',
                current_dishes_list: 'Danh S√°ch M√≥n ƒÇn Hi·ªán C√≥',
                supplier_management_title: 'Qu·∫£n L√Ω Nh√† Cung C·∫•p',
                add_new_supplier: 'Th√™m NCC M·ªõi',
                supplier_name: 'T√™n nh√† cung c·∫•p',
                contact_person: 'Ng∆∞·ªùi li√™n h·ªá',
                phone_number: 'S·ªë ƒëi·ªán tho·∫°i',
                address: 'ƒê·ªãa ch·ªâ',
                tax_code: 'M√£ s·ªë thu·∫ø (n·∫øu c√≥)',
                add_supplier_btn: 'Th√™m NCC',
                suppliers_list_title: 'Danh S√°ch Nh√† Cung C·∫•p',
                purchase_management_title: 'Nguy√™n V·∫≠t Li·ªáu & Nh·∫≠p Kho',
                define_material: 'ƒê·ªãnh Nghƒ©a Nguy√™n V·∫≠t Li·ªáu',
                material_name: 'T√™n nguy√™n li·ªáu',
                unit_placeholder: 'ƒê∆°n v·ªã (kg, gr, c√°i)',
                add_btn: 'Th√™m',
                materials_list_title: 'Danh S√°ch Nguy√™n V·∫≠t Li·ªáu',
                record_purchase: 'Nh·∫≠p Kho',
                purchase_date: 'Ng√†y nh·∫≠p h√†ng',
                material: 'Nguy√™n li·ªáu',
                quantity: 'S·ªë l∆∞·ª£ng',
                unit: 'ƒê∆°n v·ªã',
                total_price: 'T·ªïng ti·ªÅn (VND)',
                supplier: 'Nh√† cung c·∫•p',
                new_unit_price_label: 'ƒê∆°n gi√° m·ªõi s·∫Ω l√†',
                confirm_purchase_btn: 'X√°c Nh·∫≠n Nh·∫≠p Kho',
                purchase_history_title: 'L·ªãch S·ª≠ Nh·∫≠p Kho',
                spoilage_management_title: 'Qu·∫£n L√Ω Nguy√™n V·∫≠t Li·ªáu H∆∞ Hao',
                record_spoilage: 'Ghi Nh·∫≠n H∆∞ Hao',
                spoilage_date: 'Ng√†y th·∫£i b·ªè',
                spoilage_reason: 'Nguy√™n nh√¢n th·∫£i b·ªè',
                spoilage_reason_placeholder: 'VD: H·∫øt h·∫°n, h·ªèng...',
                record_btn: 'Ghi Nh·∫≠n',
                spoilage_history_title: 'L·ªãch S·ª≠ H∆∞ Hao',
                analyze_spoilage_simple: 'üìà Ph√¢n t√≠ch ƒê∆°n gi·∫£n',
                other_costs_title: 'Qu·∫£n L√Ω Chi Ph√≠ Kh√°c',
                add_new_cost: 'Th√™m Chi Ph√≠ M·ªõi',
                cost_name: 'T√™n chi ph√≠',
                amount: 'S·ªë ti·ªÅn (VND)',
                cost_type: 'Lo·∫°i chi ph√≠',
                monthly: 'H√†ng th√°ng',
                yearly: 'H√†ng nƒÉm',
                onetime: 'M·ªôt l·∫ßn (ƒê·∫ßu t∆∞)',
                add_cost_btn: 'Th√™m Chi Ph√≠',
                monthly_costs: 'Chi ph√≠ h√†ng th√°ng',
                total_monthly: 'T·ªïng c·ªông th√°ng:',
                yearly_costs: 'Chi ph√≠ h√†ng nƒÉm',
                total_yearly: 'T·ªïng c·ªông nƒÉm:',
                onetime_costs: 'Chi ph√≠ m·ªôt l·∫ßn (ƒê·∫ßu t∆∞)',
                total: 'T·ªïng c·ªông:',
                profit_report_title: 'B√°o C√°o L·ª£i Nhu·∫≠n',
                calculate_profit_btn: 'Xem B√°o C√°o',
                business_results_period: 'K·∫øt Qu·∫£ Kinh Doanh Trong K·ª≥',
                total_revenue: 'T·ªïng Doanh Thu:',
                total_cogs: 'T·ªïng Gi√° V·ªën H√†ng B√°n:',
                total_commission_fees: 'T·ªïng Ph√≠ Chi·∫øt Kh·∫•u:',
                total_operating_expenses: 'T·ªïng Chi Ph√≠ Ho·∫°t ƒê·ªông (Th√°ng):',
                spoilage_cost: 'Chi Ph√≠ H∆∞ Hao (∆Ø·ªõc T√≠nh):',
                net_profit: 'L·ª£i Nhu·∫≠n R√≤ng (Tr∆∞·ªõc Thu·∫ø):',
                view_marketing_suggestions: 'üí° Xem G·ª£i √Ω Marketing',
                revenue_structure: 'C∆° c·∫•u doanh thu',
                inventory_report_title: 'B√°o C√°o Xu·∫•t Nh·∫≠p T·ªìn Nguy√™n Li·ªáu',
                view_report_btn: 'Xem B√°o C√°o',
                material_name_header: 'T√™n Nguy√™n Li·ªáu',
                unit_header: 'ƒêVT',
                opening_stock: 'T·ªìn ƒê·∫ßu K·ª≥',
                purchased_in_period: 'Nh·∫≠p Trong K·ª≥',
                used_in_period: 'Xu·∫•t Trong K·ª≥ (B√°n)',
                spoiled_in_period: 'H∆∞ Hao Trong K·ª≥',
                closing_stock: 'T·ªìn Cu·ªëi K·ª≥',
                adjustment_logs_title: 'L·ªãch S·ª≠ ƒêi·ªÅu Ch·ªânh D·ªØ Li·ªáu',
                cancel_btn: 'H·ªßy',
                save_changes_btn: 'L∆∞u Thay ƒê·ªïi',
                edit: 'S·ª≠a',
                delete: 'X√≥a',
                empty_data: 'Ch∆∞a c√≥ d·ªØ li·ªáu.',
                empty_adjustment_logs: 'Ch∆∞a c√≥ l·ªãch s·ª≠ ƒëi·ªÅu ch·ªânh n√†o.',
                select_material: 'Ch·ªçn nguy√™n li·ªáu',
                select_supplier: 'Ch·ªçn NCC',
                log_type_supplier: 'Nh√† Cung C·∫•p',
                log_type_purchase: 'Nh·∫≠p kho',
                log_type_dish: 'M√≥n ƒÇn',
                log_type_material: 'Nguy√™n V·∫≠t Li·ªáu',
                edit_supplier_title: 'ƒêi·ªÅu Ch·ªânh Th√¥ng Tin Nh√† Cung C·∫•p',
                supplier_name_label: 'T√™n nh√† cung c·∫•p',
                tax_code_label: 'M√£ s·ªë thu·∫ø',
                adjustment_reason: 'L√Ω do ƒëi·ªÅu ch·ªânh',
                edit_purchase_title: 'ƒêi·ªÅu Ch·ªânh D·ªØ Li·ªáu Nh·∫≠p Kho',
                edit_dish_title: 'ƒêi·ªÅu Ch·ªânh Th√¥ng Tin M√≥n ƒÇn',
                price_effective_date: 'Ng√†y √Åp D·ª•ng Gi√° M·ªõi',
                edit_material_title: 'ƒêi·ªÅu Ch·ªânh Th√¥ng Tin Nguy√™n V·∫≠t Li·ªáu',
                total_time: 'T·ªïng th·ªùi gian',
                duration: 'Th·ªùi gian tr√¥i qua',
                material_categories: 'Ph√¢n lo·∫°i Nguy√™n v·∫≠t li·ªáu',
                category_name_placeholder: 'T√™n ph√¢n lo·∫°i m·ªõi',
                search_material_placeholder: 'T√¨m ki·∫øm nguy√™n v·∫≠t li·ªáu...',
                edit_category_title: 'Ch·ªânh S·ª≠a Ph√¢n Lo·∫°i',
                category_name: 'T√™n ph√¢n lo·∫°i',
                category: 'Ph√¢n lo·∫°i',
                uncategorized: 'Ch∆∞a ph√¢n lo·∫°i',
                select_category: 'Ch·ªçn ph√¢n lo·∫°i',
            },
            zh: { /* ... (Chinese translations) ... */ 
                total_time: 'Á∏ΩÊôÇÈñì',
                duration: 'Á∂ìÈÅéÊôÇÈñì',
            }
        };

        let currentLang = localStorage.getItem('language') || 'vi';
        
        let salesDataInPeriod = []; // Store filtered sales data globally for this tab
        let editingBomItems = []; // For edit dish modal
        let chartInstances = {}; // To hold chart objects

        // --- Helper Functions ---
        const formatCurrency = (amount) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount || 0);
        const findById = (arr, id) => arr.find(item => item.id === parseInt(id));
        const todayISO = () => new Date().toISOString().split('T')[0];
        
        const loadFromStorage = (key, defaultValue = []) => {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (e) {
                console.error(`Error parsing ${key} from localStorage`, e);
                return defaultValue;
            }
        };

        const formatDuration = (ms) => {
            if (!ms || ms < 0) return '00:00:00';
            const totalSeconds = Math.floor(ms / 1000);
            const hours = Math.floor(totalSeconds / 3600).toString().padStart(2, '0');
            const minutes = Math.floor((totalSeconds % 3600) / 60).toString().padStart(2, '0');
            const seconds = (totalSeconds % 60).toString().padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
        };

        // --- Data Initialization from localStorage ---
        let dishes = loadFromStorage('dishes');
        let rawMaterials = loadFromStorage('rawMaterials');
        let suppliers = loadFromStorage('suppliers');
        let purchases = loadFromStorage('purchases');
        let spoilageRecords = loadFromStorage('spoilageRecords');
        let adjustmentLogs = loadFromStorage('adjustmentLogs');
        let employees = loadFromStorage('employees');
        let otherCosts = loadFromStorage('otherCosts');
        let materialCategories = loadFromStorage('materialCategories');
        let currentBomItems = [];

        const orderStatuses = {
            'new': { name: 'ƒê∆°n m·ªõi', name_zh: 'Êñ∞Ë®ÇÂñÆ', color: '#3B82F6' },
            'preparing': { name: 'ƒêang chu·∫©n b·ªã', name_zh: 'Ê∫ñÂÇô‰∏≠', color: '#F97316' },
            'delivering': { name: 'ƒêang giao', name_zh: 'ÈÖçÈÄÅ‰∏≠', color: '#8B5CF6' },
            'completed': { name: 'Ho√†n th√†nh', name_zh: 'Â∑≤ÂÆåÊàê', color: '#10B981' },
            'cancelled': { name: 'ƒê√£ h·ªßy', name_zh: 'Â∑≤ÂèñÊ∂à', color: '#EF4444' }
        };

        const employeeRoles = {
            'taker': { name: 'Nh·∫≠n ƒê∆°n', name_zh: 'Êé•ÂñÆÂì°' },
            'kitchen': { name: 'B·∫øp', name_zh: 'ÂªöÊàø' },
            'shipper': { name: 'Giao H√†ng', name_zh: 'ÈÖçÈÄÅÂì°' }
        };
        
        const employmentTypes = {
            'part-time': {name: 'B√°n th·ªùi gian', name_zh: 'ÂÖºËÅ∑'},
            'contract': {name: 'H·ª£p ƒë·ªìng lao ƒë·ªông', name_zh: 'ÂãûÂãïÂêàÁ¥Ñ'}
        };
        
        // --- DOM Elements ---
        const elements = {
            // Modals
            editDishModal: document.getElementById('edit-dish-modal'),
            editDishForm: document.getElementById('edit-dish-form'),
            cancelEditDishBtn: document.getElementById('cancel-edit-dish'),
            editMaterialModal: document.getElementById('edit-material-modal'),
            editMaterialForm: document.getElementById('edit-material-form'),
            cancelEditMaterialBtn: document.getElementById('cancel-edit-material'),
            editCategoryModal: document.getElementById('edit-category-modal'),
            confirmationModal: document.getElementById('confirmation-modal'),
            employeeDetailsModal: document.getElementById('employee-details-modal'),
            // Menu
            dishesList: document.getElementById('dishes-list'),
            // Materials
            materialsList: document.getElementById('materials-list'),
            materialCategoriesList: document.getElementById('material-categories-list'),
            searchMaterialInput: document.getElementById('search-material-input'),
             // Employees
            addEmployeeForm: document.getElementById('add-employee-form'),
            employeesList: document.getElementById('employees-list'),
            // Sales
            orderLookupPresetFilter: document.getElementById('order-lookup-preset-filter'),
            orderLookupStartDate: document.getElementById('order-lookup-start-date'),
            orderLookupEndDate: document.getElementById('order-lookup-end-date'),
            orderLookupBtn: document.getElementById('order-lookup-btn'),
            orderStats: document.getElementById('order-stats'),
            orderDetailsList: document.getElementById('order-details-list'),
            orderDetailsTitle: document.getElementById('order-details-title'),
            // Inventory Report
            inventoryReportPresetFilter: document.getElementById('report-preset-filter'),
            inventoryReportStartDate: document.getElementById('report-start-date'),
            inventoryReportEndDate: document.getElementById('report-end-date'),
            // Profit Report
            profitReportPresetFilter: document.getElementById('profit-report-preset-filter'),
            profitReportStartDate: document.getElementById('profit-report-start-date'),
            profitReportEndDate: document.getElementById('profit-report-end-date'),
        };

        const setLanguage = (lang) => {
             currentLang = lang;
            localStorage.setItem('language', lang);
            document.querySelectorAll('[data-lang]').forEach(el => {
                const key = el.dataset.lang;
                if (translations[lang] && translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
             document.querySelectorAll('[data-lang-placeholder]').forEach(el => {
                const key = el.dataset.langPlaceholder;
                if (translations[lang] && translations[lang][key]) {
                    el.placeholder = translations[lang][key];
                }
            });
            document.querySelectorAll('.lang-btn').forEach(btn => {
                 btn.classList.toggle('active', btn.dataset.langCode === lang);
            });
            renderApp(); // Re-render the application to update dynamic content
        };
        document.querySelectorAll('.lang-btn').forEach(btn => btn.addEventListener('click', () => setLanguage(btn.dataset.langCode)));
        
        const tabLinks = document.querySelectorAll('.tab-link');
        const tabContents = document.querySelectorAll('.tab-content');
        tabLinks.forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                tabLinks.forEach(l => l.classList.remove('active:bg-gray-700', 'bg-gray-700'));
                tabContents.forEach(c => c.classList.remove('active'));
                link.classList.add('active:bg-gray-700', 'bg-gray-700');
                document.getElementById(link.dataset.tab).classList.add('active');
            });
        });

        function populateSelect(select, items, placeholderKey, valueField = 'id', textField = 'name', selectedValue = null) {
            if (!select) return;
            const placeholder = translations[currentLang]?.[placeholderKey] || placeholderKey;
            select.innerHTML = `<option value="">-- ${placeholder} --</option>`;
            items.forEach(item => {
                const isSelected = selectedValue && item[valueField] == selectedValue;
                select.innerHTML += `<option value="${item[valueField]}" ${isSelected ? 'selected' : ''}>${item[textField]}</option>`;
            });
        }
        
        function logAdjustment(typeKey, recordId, reason, changes) {
            adjustmentLogs.unshift({
                id: Date.now(),
                typeKey: typeKey,
                recordId: recordId,
                reason: reason,
                date: new Date().toISOString(),
                changes: changes
            });
            localStorage.setItem('adjustmentLogs', JSON.stringify(adjustmentLogs));
        }

        function handleDatePresetChange(presetValue, startDateInput, endDateInput) {
            const today = new Date();
            let startDate, endDate = today;

            startDateInput.disabled = true;
            endDateInput.disabled = true;

            switch (presetValue) {
                case 'this_month':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    break;
                case 'this_quarter':
                    const quarter = Math.floor(today.getMonth() / 3);
                    startDate = new Date(today.getFullYear(), quarter * 3, 1);
                    break;
                case 'this_year':
                    startDate = new Date(today.getFullYear(), 0, 1);
                    break;
                case 'custom':
                    startDateInput.disabled = false;
                    endDateInput.disabled = false;
                    startDateInput.value = '';
                    endDateInput.value = '';
                    return; // Exit here for custom
            }

            startDateInput.value = startDate.toISOString().split('T')[0];
            endDateInput.value = endDate.toISOString().split('T')[0];
        }
        // --- Employee Management ---
        function renderEmployeesList() {
            const listEl = elements.employeesList;
            listEl.innerHTML = employees.length ? employees.map(emp => {
                const statusClass = emp.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                const statusText = emp.status === 'active' ? translations[currentLang].status_active : translations[currentLang].status_terminated;
                return `
                    <div class="p-3 bg-gray-50 rounded-lg border flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <img src="${emp.photoUrl || 'https://placehold.co/40x40/E2E8F0/4A5568?text=NV'}" alt="photo" class="w-10 h-10 rounded-full object-cover">
                            <div>
                                <p class="font-semibold text-gray-800">${emp.name}</p>
                                <p class="text-sm text-gray-500">${emp.idCode}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                             <span class="text-xs font-medium px-2 py-1 rounded-full ${statusClass}">${statusText}</span>
                             <button class="view-employee-btn text-sm text-blue-600 hover:underline" data-id="${emp.id}">${translations[currentLang].view_details}</button>
                             ${emp.status === 'active' ? `<button class="terminate-employee-btn text-sm text-red-600 hover:underline" data-id="${emp.id}">${translations[currentLang].terminate_employee_btn}</button>` : ''}
                        </div>
                    </div>
                `;
            }).join('') : `<p class="text-center text-gray-500">${translations[currentLang].empty_data}</p>`;
        }

        elements.addEmployeeForm.addEventListener('submit', e => {
            e.preventDefault();
            const selectedRoles = Array.from(document.querySelectorAll('#employee-roles-checkboxes input:checked')).map(cb => cb.value);
            const newEmployee = {
                id: Date.now(),
                name: document.getElementById('employee-name').value,
                idCode: document.getElementById('employee-id-code').value,
                dob: document.getElementById('employee-dob').value,
                nid: document.getElementById('employee-nid').value,
                photoUrl: document.getElementById('employee-photo-url').value,
                permanentAddress: document.getElementById('employee-permanent-address').value,
                currentAddress: document.getElementById('employee-current-address').value,
                startDate: document.getElementById('employee-start-date').value,
                employmentType: document.getElementById('employee-type').value,
                roles: selectedRoles,
                status: 'active'
            };
            employees.push(newEmployee);
            localStorage.setItem('employees', JSON.stringify(employees));
            renderEmployeesList();
            elements.addEmployeeForm.reset();
        });

        elements.employeesList.addEventListener('click', (e) => {
            if (e.target.matches('.view-employee-btn')) {
                const employee = findById(employees, e.target.dataset.id);
                if (employee) openEmployeeDetailsModal(employee);
            }
             if (e.target.matches('.terminate-employee-btn')) {
                const employeeId = parseInt(e.target.dataset.id);
                const reason = prompt(translations[currentLang].termination_reason);
                if(reason) {
                    showConfirmation(translations[currentLang].terminate_employee_title, `B·∫°n c√≥ ch·∫Øc mu·ªën cho nh√¢n vi√™n n√†y th√¥i vi·ªác?`, () => {
                        employees = employees.map(emp => emp.id === employeeId ? { ...emp, status: 'terminated', terminationDate: todayISO(), terminationReason: reason } : emp);
                        localStorage.setItem('employees', JSON.stringify(employees));
                        renderEmployeesList();
                    });
                }
            }
        });

        function openEmployeeDetailsModal(emp) {
            const contentEl = document.getElementById('employee-modal-content');
            const rolesText = emp.roles.map(r => employeeRoles[r]?.[`name${currentLang === 'zh' ? '_zh' : ''}`] || r).join(', ');
            const empTypeText = employmentTypes[emp.employmentType]?.[`name${currentLang === 'zh' ? '_zh' : ''}`] || emp.employmentType;
            contentEl.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="md:col-span-1 text-center">
                         <img src="${emp.photoUrl || 'https://placehold.co/128x128/E2E8F0/4A5568?text=NV'}" alt="photo" class="w-32 h-32 rounded-full object-cover mx-auto mb-4">
                    </div>
                    <div class="md:col-span-2 space-y-3">
                         <p><strong>${translations[currentLang].employee_name}:</strong> ${emp.name}</p>
                         <p><strong>${translations[currentLang].employee_id_code}:</strong> ${emp.idCode}</p>
                         <p><strong>${translations[currentLang].employee_dob}:</strong> ${emp.dob}</p>
                         <p><strong>${translations[currentLang].employee_nid}:</strong> ${emp.nid}</p>
                         <p><strong>${translations[currentLang].employee_start_date}:</strong> ${emp.startDate}</p>
                         <p><strong>${translations[currentLang].employee_type}:</strong> ${empTypeText}</p>
                         <p><strong>${translations[currentLang].roles}:</strong> ${rolesText}</p>
                         <p><strong>${translations[currentLang].employee_permanent_address}:</strong> ${emp.permanentAddress}</p>
                         <p><strong>${translations[currentLang].employee_current_address}:</strong> ${emp.currentAddress}</p>
                         ${emp.status === 'terminated' ? `
                             <div class="mt-4 p-3 bg-red-50 border-l-4 border-red-400 rounded">
                                 <p><strong>${translations[currentLang].termination_date}:</strong> ${emp.terminationDate}</p>
                                 <p><strong>${translations[currentLang].termination_reason}:</strong> ${emp.terminationReason}</p>
                             </div>` : ''}
                    </div>
                </div>
            `;
            elements.employeeDetailsModal.classList.add('active');
        }

        document.getElementById('close-employee-modal-btn').addEventListener('click', () => {
            elements.employeeDetailsModal.classList.remove('active');
        });

        // --- Sales & Order Lookup Logic ---
        elements.orderLookupPresetFilter.addEventListener('change', (e) => handleDatePresetChange(e.target.value, elements.orderLookupStartDate, elements.orderLookupEndDate));
        elements.inventoryReportPresetFilter.addEventListener('change', (e) => handleDatePresetChange(e.target.value, elements.inventoryReportStartDate, elements.inventoryReportEndDate));
        elements.profitReportPresetFilter.addEventListener('change', (e) => handleDatePresetChange(e.target.value, elements.profitReportStartDate, elements.profitReportEndDate));

        elements.orderLookupBtn.addEventListener('click', () => {
            const startDate = new Date(elements.orderLookupStartDate.value);
            startDate.setHours(0, 0, 0, 0);
            const endDate = new Date(elements.orderLookupEndDate.value);
            endDate.setHours(23, 59, 59, 999);

            if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
                alert("Vui l√≤ng ch·ªçn ng√†y h·ª£p l·ªá.");
                return;
            }

            const activeOrders = loadFromStorage('activeOrders');
            const completedOrders = loadFromStorage('completedOrders');
            const cancelledOrders = loadFromStorage('cancelledOrders');

            const allOrdersInPeriod = [];

            activeOrders.forEach(order => {
                const orderDate = new Date(order.timestamps.created);
                if (orderDate >= startDate && orderDate <= endDate) {
                    allOrdersInPeriod.push({ ...order, finalStatus: order.status });
                }
            });

            completedOrders.forEach(order => {
                const orderDate = new Date(order.timestamps.completed);
                if (orderDate >= startDate && orderDate <= endDate) {
                    allOrdersInPeriod.push({ ...order, finalStatus: 'completed' });
                }
            });

            cancelledOrders.forEach(record => {
                const orderDate = new Date(record.timestamp);
                if (orderDate >= startDate && orderDate <= endDate) {
                    allOrdersInPeriod.push({ 
                        ...record.order, 
                        finalStatus: 'cancelled', 
                        cancellationReason: record.reason,
                        cancellationTimestamp: record.timestamp
                    });
                }
            });
            
            salesDataInPeriod = allOrdersInPeriod; // Store for filtering
            renderOrderStats(salesDataInPeriod);
            elements.orderDetailsTitle.classList.add('hidden');
            elements.orderDetailsList.innerHTML = '';
        });

        function renderOrderStats(orders) {
            const counts = Object.keys(orderStatuses).reduce((acc, key) => ({...acc, [key]: 0}), {});
            orders.forEach(order => {
                if (counts.hasOwnProperty(order.finalStatus)) {
                    counts[order.finalStatus]++;
                }
            });

            elements.orderStats.innerHTML = Object.keys(orderStatuses).map(statusKey => {
                const status = orderStatuses[statusKey];
                const count = counts[statusKey];
                const name = status[`name${currentLang === 'zh' ? '_zh' : ''}`] || status.name;
                return `
                    <div class="stat-card p-4 bg-white rounded-lg shadow-md text-center cursor-pointer border-2 border-transparent" style="--status-color: ${status.color};" data-status="${statusKey}">
                        <p class="text-3xl font-bold" style="color: ${status.color};">${count}</p>
                        <p class="text-sm font-medium text-gray-600">${name}</p>
                    </div>
                `;
            }).join('');
        }

        elements.orderStats.addEventListener('click', (e) => {
            const card = e.target.closest('.stat-card');
            if (!card) return;

            const statusKey = card.dataset.status;
            const filteredData = salesDataInPeriod.filter(sale => sale.finalStatus === statusKey);
            
            const statusName = orderStatuses[statusKey]?.[`name${currentLang === 'zh' ? '_zh' : ''}`] || statusKey;
            elements.orderDetailsTitle.textContent = `${translations[currentLang].order_list}: ${statusName}`;
            elements.orderDetailsTitle.classList.remove('hidden');

            renderOrderDetailsList(filteredData);
        });

        function renderOrderDetailsList(data) {
             elements.orderDetailsList.innerHTML = data.length ? data.map(order => {
                const statusInfo = orderStatuses[order.finalStatus];
                const dishNames = order.items.map(i => findById(dishes, i.dishId)?.name || 'N/A').join(', ');

                const timeInfoHtml = (() => {
                    if (order.finalStatus === 'completed') {
                        const duration = order.timestamps.completed - order.timestamps.created;
                        return `<div class="text-right">
                                    <p class="font-semibold text-green-600">${formatDuration(duration)}</p>
                                    <p class="text-xs text-gray-500" data-lang="total_time">${translations[currentLang].total_time}</p>
                                </div>`;
                    } else if (order.finalStatus === 'cancelled') {
                        const duration = order.cancellationTimestamp - order.timestamps.created;
                        return `<div class="text-right">
                                    <p class="font-semibold text-red-600">${formatDuration(duration)}</p>
                                    <p class="text-xs text-gray-500" data-lang="total_time">${translations[currentLang].total_time}</p>
                                </div>`;
                    } else { // new, preparing, delivering
                        return `<div class="text-right">
                                    <p class="font-semibold text-blue-600 live-timer" data-timestamp="${order.timestamps.created}">00:00:00</p>
                                    <p class="text-xs text-gray-500" data-lang="duration">${translations[currentLang].duration}</p>
                                </div>`;
                    }
                })();

                 return `
                    <div class="p-4 bg-gray-50 rounded-lg border-l-4" style="border-color: ${statusInfo.color};">
                        <div class="flex flex-wrap justify-between items-center gap-2">
                            <div>
                                <p class="font-bold text-gray-800">${order.customer.orderId}</p>
                                <p class="text-sm text-gray-600">${dishNames}</p>
                                <p class="text-xs text-gray-500">${new Date(order.timestamps.created).toLocaleString('vi-VN')}</p>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="text-right">
                                    <p class="font-semibold text-gray-800">${order.customer.name}</p>
                                    <p class="text-xs text-gray-500">${order.customer.phone}</p>
                                </div>
                                ${timeInfoHtml}
                            </div>
                        </div>
                        ${order.finalStatus === 'cancelled' ? `<p class="text-xs text-red-600 mt-1">L√Ω do h·ªßy: ${order.cancellationReason}</p>` : ''}
                    </div>
                `;
             }).join('') : `<p class="text-gray-500 text-sm p-4 text-center">${translations[currentLang].empty_data}</p>`;
        }
        
        // --- Menu Management ---
        const renderDish = (d) => {
             const currentPrice = getPriceForDate(d, new Date());
             return `
            <div class="flex justify-between items-start p-3 bg-gray-50 rounded-md border">
                <div>
                    <p class="font-semibold">${d.name} - ${formatCurrency(currentPrice)}</p>
                    <p class="text-sm text-gray-500">${translations[currentLang].estimated_cost}: ${formatCurrency(d.cost)}</p>
                </div>
                <div class="flex gap-2">
                    <button class="edit-dish-btn text-xs bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-semibold py-1 px-2 rounded" data-id="${d.id}">${translations[currentLang].edit}</button>
                    <button class="delete-dish-btn text-xs bg-red-400 hover:bg-red-500 text-red-900 font-semibold py-1 px-2 rounded" data-id="${d.id}">${translations[currentLang].delete}</button>
                </div>
            </div>
        `};

        elements.dishesList.addEventListener('click', e => {
            if (e.target.matches('.edit-dish-btn')) {
                const dish = findById(dishes, e.target.dataset.id);
                if (dish) openEditDishModal(dish);
            }
            if (e.target.matches('.delete-dish-btn')) {
                showConfirmation('X√°c nh·∫≠n x√≥a', 'B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a m√≥n ƒÉn n√†y?', () => {
                    dishes = dishes.filter(d => d.id !== parseInt(e.target.dataset.id));
                    localStorage.setItem('dishes', JSON.stringify(dishes));
                    renderApp();
                });
            }
        });

        function openEditDishModal(dish) {
            const modal = elements.editDishModal;
            modal.querySelector('#edit-dish-id').value = dish.id;
            modal.querySelector('#edit-dish-name').value = dish.name;
            modal.querySelector('#edit-dish-description').value = dish.description;
            modal.querySelector('#edit-dish-image-url').value = dish.imageUrl || '';
            
            const currentPrice = getPriceForDate(dish, new Date());
            modal.querySelector('#edit-dish-price').value = currentPrice;
            modal.querySelector('#edit-dish-price-effective-date').value = '';

            editingBomItems = JSON.parse(JSON.stringify(dish.bom || []));
            populateMaterialSelects(modal.querySelector('#edit-bom-material-select'));
            renderEditingBomItems();
            modal.classList.add('active');
        }

        elements.cancelEditDishBtn.addEventListener('click', () => elements.editDishModal.classList.remove('active'));

        elements.editDishModal.querySelector('#edit-add-bom-item-btn').addEventListener('click', () => {
             const materialId = parseInt(elements.editDishModal.querySelector('#edit-bom-material-select').value);
            const quantity = parseFloat(elements.editDishModal.querySelector('#edit-bom-quantity').value);
            if (materialId && quantity > 0 && !editingBomItems.some(item => item.materialId === materialId)) {
                editingBomItems.push({ materialId, quantity });
                renderEditingBomItems();
                elements.editDishModal.querySelector('#edit-bom-quantity').value = '';
            }
        });

        function renderEditingBomItems() {
            const listEl = elements.editDishModal.querySelector('#edit-bom-items-list');
            listEl.innerHTML = editingBomItems.map((item, index) => {
                const material = findById(rawMaterials, item.materialId);
                return `<div class="flex justify-between items-center text-sm p-1 bg-blue-50 rounded">
                    <span>${material?.name || 'N/A'} - ${item.quantity} ${material?.unit || ''}</span>
                    <button type="button" class="remove-bom-item-btn text-red-500" data-index="${index}">X</button>
                </div>`;
            }).join('');
            
            elements.editDishModal.querySelector('#edit-estimated-cost').textContent = formatCurrency(calculateBomCost(editingBomItems));

            listEl.querySelectorAll('.remove-bom-item-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    editingBomItems.splice(parseInt(e.target.dataset.index), 1);
                    renderEditingBomItems();
                });
            });
        }
        
        elements.editDishForm.addEventListener('submit', e => {
            e.preventDefault();
            const dishId = parseInt(document.getElementById('edit-dish-id').value);
            const reason = document.getElementById('edit-dish-reason').value;
            const originalDish = findById(dishes, dishId);
            
            const newPrice = parseFloat(document.getElementById('edit-dish-price').value);
            const effectiveDate = document.getElementById('edit-dish-price-effective-date').value;
            const priceHistory = originalDish.priceHistory || [{ price: originalDish.price, effectiveDate: '1970-01-01'}];
            
            if (newPrice !== getPriceForDate(originalDish, new Date(effectiveDate || todayISO()))) {
                if(!effectiveDate) { alert('Vui l√≤ng ch·ªçn ng√†y √°p d·ª•ng gi√° m·ªõi.'); return; }
                 priceHistory.push({ price: newPrice, effectiveDate });
            }

            const updatedDish = {
                ...originalDish,
                name: document.getElementById('edit-dish-name').value,
                description: document.getElementById('edit-dish-description').value,
                imageUrl: document.getElementById('edit-dish-image-url').value,
                price: getPriceForDate({...originalDish, priceHistory}, new Date()),
                priceHistory: priceHistory,
                bom: editingBomItems,
                cost: calculateBomCost(editingBomItems)
            };
            
            logAdjustment('log_type_dish', dishId, reason, {}); // Simplified log for now
            dishes = dishes.map(d => d.id === dishId ? updatedDish : d);
            localStorage.setItem('dishes', JSON.stringify(dishes));
            
            elements.editDishModal.classList.remove('active');
            e.target.reset();
            renderApp();
        });

        // --- Material & Category Management ---
        function renderMaterialCategories() {
            const listEl = elements.materialCategoriesList;
            listEl.innerHTML = materialCategories.map(cat => `
                <div class="flex justify-between items-center p-2 bg-gray-100 rounded-md">
                    <span>${cat.name}</span>
                    <div class="flex gap-2">
                         <button class="edit-category-btn text-xs text-yellow-700 hover:text-yellow-900" data-id="${cat.id}">S·ª≠a</button>
                        <button class="delete-category-btn text-xs text-red-500 hover:text-red-700" data-id="${cat.id}">X√≥a</button>
                    </div>
                </div>
            `).join('');
            populateSelect(document.getElementById('material-category-select'), materialCategories, 'select_category');
        }

        document.getElementById('add-category-form').addEventListener('submit', e => {
            e.preventDefault();
            const nameInput = document.getElementById('category-name');
            const name = nameInput.value.trim();
            if (name) {
                materialCategories.push({ id: Date.now(), name });
                localStorage.setItem('materialCategories', JSON.stringify(materialCategories));
                renderMaterialCategories();
                nameInput.value = '';
            }
        });

        elements.materialCategoriesList.addEventListener('click', e => {
            if (e.target.matches('.edit-category-btn')) {
                const category = findById(materialCategories, e.target.dataset.id);
                if (category) openEditCategoryModal(category);
            }
            if (e.target.matches('.delete-category-btn')) {
                handleDeleteCategory(parseInt(e.target.dataset.id));
            }
        });

        function openEditCategoryModal(category) {
            const modal = elements.editCategoryModal;
            modal.querySelector('#edit-category-id').value = category.id;
            modal.querySelector('#edit-category-name').value = category.name;
            modal.classList.add('active');
        }

        document.getElementById('cancel-edit-category').addEventListener('click', () => elements.editCategoryModal.classList.remove('active'));
        
        document.getElementById('edit-category-form').addEventListener('submit', e => {
            e.preventDefault();
            const catId = parseInt(document.getElementById('edit-category-id').value);
            const newName = document.getElementById('edit-category-name').value.trim();
            if(newName) {
                materialCategories = materialCategories.map(c => c.id === catId ? {...c, name: newName} : c);
                localStorage.setItem('materialCategories', JSON.stringify(materialCategories));
                elements.editCategoryModal.classList.remove('active');
                renderApp();
            }
        });

        function handleDeleteCategory(categoryId) {
            showConfirmation('X√≥a ph√¢n lo·∫°i?', 'B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ph√¢n lo·∫°i n√†y? C√°c nguy√™n v·∫≠t li·ªáu trong nh√≥m s·∫Ω tr·ªü th√†nh "Ch∆∞a ph√¢n lo·∫°i".', () => {
                materialCategories = materialCategories.filter(c => c.id !== categoryId);
                rawMaterials.forEach(m => {
                    if (m.categoryId === categoryId) {
                        m.categoryId = null;
                    }
                });
                localStorage.setItem('materialCategories', JSON.stringify(materialCategories));
                localStorage.setItem('rawMaterials', JSON.stringify(rawMaterials));
                renderApp();
            });
        }
        
        document.getElementById('add-material-form').addEventListener('submit', e => {
            e.preventDefault();
            const name = document.getElementById('material-name').value.trim();
            const unit = document.getElementById('material-unit').value.trim();
            const categoryId = parseInt(document.getElementById('material-category-select').value) || null;
            if (name && unit) {
                rawMaterials.push({ id: Date.now(), name, unit, price: 0, categoryId });
                localStorage.setItem('rawMaterials', JSON.stringify(rawMaterials));
                renderMaterialsList();
                e.target.reset();
            }
        });

        elements.searchMaterialInput.addEventListener('input', () => renderMaterialsList());

        function renderMaterialsList() {
            const searchTerm = elements.searchMaterialInput.value.toLowerCase();
            const listEl = elements.materialsList;

            const filteredMaterials = rawMaterials.filter(m => m.name.toLowerCase().includes(searchTerm));
            const grouped = filteredMaterials.reduce((acc, m) => {
                const catId = m.categoryId || 'uncategorized';
                if (!acc[catId]) acc[catId] = [];
                acc[catId].push(m);
                return acc;
            }, {});

            const categoryOrder = materialCategories.map(c => c.id);
            if (grouped.uncategorized) categoryOrder.push('uncategorized');

            listEl.innerHTML = categoryOrder.map(catId => {
                if (!grouped[catId]) return '';
                const category = catId === 'uncategorized' ? { name: translations[currentLang].uncategorized } : findById(materialCategories, catId);
                if (!category) return '';

                const materialsHtml = grouped[catId].map(m => `
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded-md">
                        <div>
                            <p class="font-medium text-sm">${m.name} (${m.unit})</p>
                            <p class="font-mono text-xs text-gray-600">${formatCurrency(m.price)}</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <button class="edit-material-btn text-xs text-yellow-700 hover:text-yellow-900" data-id="${m.id}">${translations[currentLang].edit}</button>
                            <button class="delete-material-btn text-xs text-red-500 hover:text-red-700" data-id="${m.id}">${translations[currentLang].delete}</button>
                        </div>
                    </div>`).join('');

                return `<div>
                            <h4 class="font-semibold text-gray-700 text-md mt-2 mb-1 pb-1 border-b">${category.name}</h4>
                            <div class="space-y-2">${materialsHtml}</div>
                        </div>`;
            }).join('') || `<p class="text-gray-500 text-center">${translations[currentLang].empty_data}</p>`;
        }
        
        elements.materialsList.addEventListener('click', e => {
            if (e.target.matches('.edit-material-btn')) {
                const material = findById(rawMaterials, e.target.dataset.id);
                if (material) openEditMaterialModal(material);
            }
            if (e.target.matches('.delete-material-btn')) {
                handleDeleteMaterial(parseInt(e.target.dataset.id));
            }
        });

        function handleDeleteMaterial(materialId) {
            const isUsed = dishes.some(d => d.bom && d.bom.some(item => item.materialId === materialId));
            if (isUsed) {
                alert('Kh√¥ng th·ªÉ x√≥a nguy√™n v·∫≠t li·ªáu n√†y v√¨ n√≥ ƒëang ƒë∆∞·ª£c s·ª≠ d·ª•ng trong ƒë·ªãnh l∆∞·ª£ng c·ªßa m·ªôt m√≥n ƒÉn.');
                return;
            }
            showConfirmation('X√≥a nguy√™n li·ªáu?', 'B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a nguy√™n v·∫≠t li·ªáu n√†y?', () => {
                 rawMaterials = rawMaterials.filter(m => m.id !== materialId);
                localStorage.setItem('rawMaterials', JSON.stringify(rawMaterials));
                renderApp();
            });
        }

        function openEditMaterialModal(material) {
            const modal = elements.editMaterialModal;
            populateSelect(modal.querySelector('#edit-material-category-select'), materialCategories, 'select_category', 'id', 'name', material.categoryId);
            modal.querySelector('#edit-material-id').value = material.id;
            modal.querySelector('#edit-material-name').value = material.name;
            modal.querySelector('#edit-material-unit').value = material.unit;
            modal.classList.add('active');
        }
        
        elements.cancelEditMaterialBtn.addEventListener('click', () => elements.editMaterialModal.classList.remove('active'));

        elements.editMaterialForm.addEventListener('submit', e => {
            e.preventDefault();
            const materialId = parseInt(document.getElementById('edit-material-id').value);
            const reason = document.getElementById('edit-material-reason').value;

            const updatedMaterial = {
                ...findById(rawMaterials, materialId),
                name: document.getElementById('edit-material-name').value,
                unit: document.getElementById('edit-material-unit').value,
                categoryId: parseInt(document.getElementById('edit-material-category-select').value) || null,
            };

            logAdjustment('log_type_material', materialId, reason, {});
            rawMaterials = rawMaterials.map(m => m.id === materialId ? updatedMaterial : m);
            localStorage.setItem('rawMaterials', JSON.stringify(rawMaterials));

            elements.editMaterialModal.classList.remove('active');
            e.target.reset();
            renderApp();
        });

        function getPriceForDate(dish, date) {
            if (!dish.priceHistory || dish.priceHistory.length === 0) return dish.price;
            const sortedHistory = [...dish.priceHistory].sort((a, b) => new Date(b.effectiveDate) - new Date(a.effectiveDate));
            const dateString = date.toISOString().split('T')[0];
            for (const entry of sortedHistory) {
                if (entry.effectiveDate <= dateString) return entry.price;
            }
            return dish.price; // fallback to base price
        }
        
        function calculateBomCost(bomItems) {
            return bomItems.reduce((total, item) => {
                const material = findById(rawMaterials, item.materialId);
                return total + (material ? material.price * item.quantity : 0);
            }, 0);
        }
        
        function updateAllMaterialPrices() {
            const latestPurchases = {};
            const sortedPurchases = [...purchases].sort((a, b) => new Date(b.date) - new Date(a.date));

            for (const p of sortedPurchases) {
                if (!latestPurchases[p.materialId]) {
                    latestPurchases[p.materialId] = p.unitPrice;
                }
            }

            rawMaterials.forEach(material => {
                material.price = latestPurchases[material.id] || material.price || 0;
            });

            localStorage.setItem('rawMaterials', JSON.stringify(rawMaterials));
        }

        function recalculateAllDishCosts() {
             dishes.forEach(dish => {
                dish.cost = calculateBomCost(dish.bom);
            });
            localStorage.setItem('dishes', JSON.stringify(dishes));
        }
        
        function populateMaterialSelects(selectElement) {
            const placeholder = translations[currentLang].select_material;
            selectElement.innerHTML = `<option value="">-- ${placeholder} --</option>`;

            const grouped = rawMaterials.reduce((acc, m) => {
                const catId = m.categoryId || 'uncategorized';
                if (!acc[catId]) acc[catId] = [];
                acc[catId].push(m);
                return acc;
            }, {});

             materialCategories.forEach(cat => {
                if (grouped[cat.id]) {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = cat.name;
                    grouped[cat.id].forEach(m => {
                        const option = document.createElement('option');
                        option.value = m.id;
                        option.textContent = m.name;
                        optgroup.appendChild(option);
                    });
                    selectElement.appendChild(optgroup);
                }
            });

            if (grouped.uncategorized) {
                const optgroup = document.createElement('optgroup');
                optgroup.label = translations[currentLang].uncategorized;
                grouped.uncategorized.forEach(m => {
                     const option = document.createElement('option');
                     option.value = m.id;
                     option.textContent = m.name;
                     optgroup.appendChild(option);
                });
                selectElement.appendChild(optgroup);
            }
        }
        
        // --- API-Free "AI" Replacements ---
        document.getElementById('suggest-name-btn').addEventListener('click', () => {
            const mainIngredient = prompt("Nh·∫≠p nguy√™n li·ªáu ch√≠nh (vd: G√†, B√≤, N·∫•m):", "");
            if(!mainIngredient) return;
            
            const styles = ["h·∫ßm", "ti·ªÅm", "n·∫•u", "x√†o", "ch∆∞ng"];
            const additions = ["thu·ªëc b·∫Øc", "h·∫°t sen", "t√°o ƒë·ªè", "ƒë√¥ng tr√πng h·∫° th·∫£o", "s√¢m"];
            const chosenStyle = styles[Math.floor(Math.random() * styles.length)];
            const chosenAddition = additions[Math.floor(Math.random() * additions.length)];
            
            document.getElementById('dish-name').value = `Canh ${mainIngredient} ${chosenStyle} ${chosenAddition}`;
        });

        document.getElementById('suggest-description-btn').addEventListener('click', () => {
            const dishName = document.getElementById('dish-name').value;
            if(!dishName) { alert("Vui l√≤ng nh·∫≠p t√™n m√≥n ƒÉn tr∆∞·ªõc."); return; }

            const templates = [
                `M·ªôt s·ª± k·∫øt h·ª£p tinh t·∫ø c·ªßa c√°c lo·∫°i th·∫£o m·ªôc qu√Ω, ${dishName} kh√¥ng ch·ªâ l√† m·ªôt m√≥n ƒÉn ngon m√† c√≤n l√† m·ªôt b√†i thu·ªëc b·ªìi b·ªï s·ª©c kh·ªèe, gi√∫p tƒÉng c∆∞·ªùng sinh l·ª±c v√† an th·∫ßn.`,
                `${dishName} mang ƒë·∫øn h∆∞∆°ng v·ªã ƒë·∫≠m ƒë√†, ng·ªçt thanh t·ª± nhi√™n t·ª´ c√°c nguy√™n li·ªáu ƒë∆∞·ª£c h·∫ßm k·ªπ trong nhi·ªÅu gi·ªù, l√† l·ª±a ch·ªçn ho√†n h·∫£o cho m·ªôt b·ªØa ƒÉn d∆∞·ª°ng sinh.`,
                `Th∆∞·ªüng th·ª©c ${dishName} ƒë·ªÉ c·∫£m nh·∫≠n s·ª± h√≤a quy·ªán tuy·ªát v·ªùi gi·ªØa v·ªã ngon c·ªßa nguy√™n li·ªáu v√† c√¥ng d·ª•ng tuy·ªát v·ªùi cho s·ª©c kh·ªèe, gi√∫p c∆° th·ªÉ kh·ªèe m·∫°nh t·ª´ b√™n trong.`
            ];
            document.getElementById('dish-description').value = templates[Math.floor(Math.random() * templates.length)];
        });

        document.getElementById('analyze-spoilage-btn').addEventListener('click', () => {
            const resultDiv = document.getElementById('spoilage-analysis-result');
            if (spoilageRecords.length === 0) {
                resultDiv.innerHTML = `<p>Ch∆∞a c√≥ d·ªØ li·ªáu h∆∞ hao ƒë·ªÉ ph√¢n t√≠ch.</p>`;
                resultDiv.classList.remove('hidden');
                return;
            }

            const analysis = spoilageRecords.reduce((acc, record) => {
                const material = findById(rawMaterials, record.materialId);
                if (material) {
                    const value = (acc[material.name] || 0) + (record.quantity * material.price);
                    acc[material.name] = value;
                }
                return acc;
            }, {});

            const sorted = Object.entries(analysis).sort((a, b) => b[1] - a[1]);

            let html = `
                <h4 class="font-bold text-md mb-2">Ph√¢n t√≠ch chi ph√≠ h∆∞ hao h√†ng ƒë·∫ßu:</h4>
                <ul class="list-disc pl-5 space-y-1 text-sm">
            `;
            sorted.slice(0, 3).forEach(([name, value]) => {
                html += `<li><strong>${name}</strong>: Th·∫•t tho√°t kho·∫£ng ${formatCurrency(value)}</li>`;
            });
            html += `</ul><p class="text-xs mt-3"><i>G·ª£i √Ω: C√¢n nh·∫Øc gi·∫£m l∆∞·ª£ng nh·∫≠p h√†ng ho·∫∑c ki·ªÉm tra l·∫°i quy tr√¨nh b·∫£o qu·∫£n cho c√°c nguy√™n li·ªáu n√†y.</i></p>`;
            
            resultDiv.innerHTML = html;
            resultDiv.classList.remove('hidden');
        });

         document.getElementById('suggest-marketing-btn').addEventListener('click', () => {
            const suggestionsDiv = document.getElementById('marketing-suggestions');
            const bestSeller = "M√≥n b√°n ch·∫°y nh·∫•t c·ªßa b·∫°n"; // Placeholder
            const suggestionsHTML = `
                <h4 class="font-bold text-md mb-2">G·ª£i √Ω chi·∫øn l∆∞·ª£c Marketing:</h4>
                <ul class="list-disc pl-5 space-y-2 text-sm">
                    <li><strong>T·∫≠p trung v√†o m√≥n ch·ªß l·ª±c:</strong> Ch·∫°y c√°c chi·∫øn d·ªãch qu·∫£ng c√°o tr√™n m·∫°ng x√£ h·ªôi (Facebook, Instagram) cho "${bestSeller}".</li>
                    <li><strong>T·∫°o Combo h·∫•p d·∫´n:</strong> K·∫øt h·ª£p c√°c m√≥n b√°n ch·∫°y v·ªõi c√°c m√≥n √≠t ph·ªï bi·∫øn h∆°n ƒë·ªÉ t·∫°o th√†nh combo v·ªõi gi√° ∆∞u ƒë√£i.</li>
                    <li><strong>Ch∆∞∆°ng tr√¨nh kh√°ch h√†ng th√¢n thi·∫øt:</strong> T√≠ch ƒëi·ªÉm cho kh√°ch h√†ng sau m·ªói l·∫ßn mua ƒë·ªÉ ƒë·ªïi l·∫•y ∆∞u ƒë√£i ho·∫∑c s·∫£n ph·∫©m mi·ªÖn ph√≠.</li>
                    <li><strong>H·ª£p t√°c v·ªõi ng∆∞·ªùi c√≥ ·∫£nh h∆∞·ªüng (KOLs):</strong> M·ªùi c√°c food blogger ƒë·∫øn tr·∫£i nghi·ªám v√† review nh√† h√†ng c·ªßa b·∫°n.</li>
                    <li><strong>T·ªëi ∆∞u h√≥a tr√™n c√°c ·ª©ng d·ª•ng giao h√†ng:</strong> S·ª≠ d·ª•ng c√°c g√≥i qu·∫£ng c√°o, Freeship Xtra, ho·∫∑c t·∫°o c√°c deal ƒë·ªôc quy·ªÅn tr√™n GrabFood, ShopeeFood.</li>
                </ul>
            `;
            suggestionsDiv.innerHTML = suggestionsHTML;
            suggestionsDiv.classList.toggle('hidden');
        });

        // --- Confirmation Modal Logic ---
        function showConfirmation(title, message, onConfirm) {
            const modal = elements.confirmationModal;
            modal.querySelector('#confirmation-title').textContent = title;
            modal.querySelector('#confirmation-message').textContent = message;
            
            const confirmBtn = modal.querySelector('#confirm-ok-btn');
            const cancelBtn = modal.querySelector('#confirm-cancel-btn');

            const confirmHandler = () => {
                onConfirm();
                closeModal();
            };
            
            const closeModal = () => {
                modal.classList.remove('active');
                confirmBtn.removeEventListener('click', confirmHandler);
            };

            confirmBtn.addEventListener('click', confirmHandler, { once: true });
            cancelBtn.addEventListener('click', closeModal, { once: true });
            
            modal.classList.add('active');
        }


        function renderApp() {
            updateAllMaterialPrices();
            recalculateAllDishCosts();
            
            // Employee role checkboxes
            const rolesContainer = document.getElementById('employee-roles-checkboxes');
            if(rolesContainer) {
                rolesContainer.innerHTML = Object.keys(employeeRoles).map(key => `
                    <label class="flex items-center">
                        <input type="checkbox" name="employee-roles" value="${key}" class="h-4 w-4 text-indigo-600 border-gray-300 rounded">
                        <span class="ml-2 text-gray-700">${employeeRoles[key][`name${currentLang === 'zh' ? '_zh' : ''}`] || employeeRoles[key].name}</span>
                    </label>
                `).join('');
            }
            
            // Populate all material dropdowns
            populateMaterialSelects(document.getElementById('bom-material-select'));
            populateMaterialSelects(document.getElementById('purchase-material-select'));
            populateMaterialSelects(document.getElementById('spoilage-material-select'));

            // Render lists
            elements.dishesList.innerHTML = dishes.map(renderDish).join('');
            renderMaterialCategories();
            renderMaterialsList();
            renderDashboard();
            renderEmployeesList(); // <-- FIX: Add this call
        }
        
         // --- Dashboard Logic ---
        function renderDashboard() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const completedToday = loadFromStorage('completedOrders').filter(o => new Date(o.timestamps.completed) >= today);
            const activeToday = loadFromStorage('activeOrders').filter(o => new Date(o.timestamps.created) >= today);
            
            const revenueToday = completedToday.reduce((sum, order) => sum + order.totalPrice, 0);
            document.getElementById('dashboard-revenue').textContent = formatCurrency(revenueToday);
            document.getElementById('dashboard-orders').textContent = activeToday.length + completedToday.length;
            
            // Best seller logic
            const dishCounts = completedToday.flatMap(o => o.items).reduce((acc, item) => {
                acc[item.dishId] = (acc[item.dishId] || 0) + item.quantity;
                return acc;
            }, {});
            const bestSellerId = Object.keys(dishCounts).sort((a,b) => dishCounts[b] - dishCounts[a])[0];
            const bestSellerDish = findById(dishes, bestSellerId);
            document.getElementById('dashboard-best-seller').textContent = bestSellerDish ? bestSellerDish.name : 'N/A';

            // Chart
            const statusCounts = [...activeToday, ...completedToday].reduce((acc, order) => {
                const status = order.finalStatus || order.status;
                acc[status] = (acc[status] || 0) + 1;
                return acc;
            }, {});

            renderPieChart('orderStatusChart', {
                labels: Object.keys(statusCounts).map(key => orderStatuses[key]?.name || key),
                data: Object.values(statusCounts),
                colors: Object.keys(statusCounts).map(key => orderStatuses[key]?.color || '#ccc')
            });
        }
        
        // --- Charting Function ---
        function renderPieChart(canvasId, { labels, data, colors }) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            if (chartInstances[canvasId]) {
                chartInstances[canvasId].destroy();
            }
            chartInstances[canvasId] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        }
                    }
                }
            });
        }


        // --- Live Timer Update ---
        setInterval(() => {
            document.querySelectorAll('.live-timer').forEach(timerEl => {
                const timestamp = parseInt(timerEl.dataset.timestamp, 10);
                if (!isNaN(timestamp)) {
                    const duration = Date.now() - timestamp;
                    timerEl.textContent = formatDuration(duration);
                }
            });
        }, 1000);
        
        // --- INITIAL LOAD ---
        handleDatePresetChange('this_month', elements.orderLookupStartDate, elements.orderLookupEndDate);
        handleDatePresetChange('this_month', elements.inventoryReportStartDate, elements.inventoryReportEndDate);
        handleDatePresetChange('this_month', elements.profitReportStartDate, elements.profitReportEndDate);
        renderApp();
        setLanguage(currentLang);
    });
    </script>
</body>
</html>

